{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Node = void 0;\n\nconst Util_1 = require(\"./Util\");\n\nconst Factory_1 = require(\"./Factory\");\n\nconst Canvas_1 = require(\"./Canvas\");\n\nconst Global_1 = require(\"./Global\");\n\nconst DragAndDrop_1 = require(\"./DragAndDrop\");\n\nconst Validators_1 = require(\"./Validators\");\n\nvar ABSOLUTE_OPACITY = 'absoluteOpacity',\n    ALL_LISTENERS = 'allEventListeners',\n    ABSOLUTE_TRANSFORM = 'absoluteTransform',\n    ABSOLUTE_SCALE = 'absoluteScale',\n    CANVAS = 'canvas',\n    CHANGE = 'Change',\n    CHILDREN = 'children',\n    KONVA = 'konva',\n    LISTENING = 'listening',\n    MOUSEENTER = 'mouseenter',\n    MOUSELEAVE = 'mouseleave',\n    NAME = 'name',\n    SET = 'set',\n    SHAPE = 'Shape',\n    SPACE = ' ',\n    STAGE = 'stage',\n    TRANSFORM = 'transform',\n    UPPER_STAGE = 'Stage',\n    VISIBLE = 'visible',\n    TRANSFORM_CHANGE_STR = ['xChange.konva', 'yChange.konva', 'scaleXChange.konva', 'scaleYChange.konva', 'skewXChange.konva', 'skewYChange.konva', 'rotationChange.konva', 'offsetXChange.konva', 'offsetYChange.konva', 'transformsEnabledChange.konva'].join(SPACE);\nlet idCounter = 1;\n\nclass Node {\n  constructor(config) {\n    this._id = idCounter++;\n    this.eventListeners = {};\n    this.attrs = {};\n    this.index = 0;\n    this._allEventListeners = null;\n    this.parent = null;\n    this._cache = new Map();\n    this._attachedDepsListeners = new Map();\n    this._lastPos = null;\n    this._batchingTransformChange = false;\n    this._needClearTransformCache = false;\n    this._filterUpToDate = false;\n    this._isUnderCache = false;\n    this._dragEventId = null;\n    this._shouldFireChangeEvents = false;\n    this.setAttrs(config);\n    this._shouldFireChangeEvents = true;\n  }\n\n  hasChildren() {\n    return false;\n  }\n\n  _clearCache(attr) {\n    if ((attr === TRANSFORM || attr === ABSOLUTE_TRANSFORM) && this._cache.get(attr)) {\n      this._cache.get(attr).dirty = true;\n    } else if (attr) {\n      this._cache.delete(attr);\n    } else {\n      this._cache.clear();\n    }\n  }\n\n  _getCache(attr, privateGetter) {\n    var cache = this._cache.get(attr);\n\n    var isTransform = attr === TRANSFORM || attr === ABSOLUTE_TRANSFORM;\n    var invalid = cache === undefined || isTransform && cache.dirty === true;\n\n    if (invalid) {\n      cache = privateGetter.call(this);\n\n      this._cache.set(attr, cache);\n    }\n\n    return cache;\n  }\n\n  _calculate(name, deps, getter) {\n    if (!this._attachedDepsListeners.get(name)) {\n      const depsString = deps.map(dep => dep + 'Change.konva').join(SPACE);\n      this.on(depsString, () => {\n        this._clearCache(name);\n      });\n\n      this._attachedDepsListeners.set(name, true);\n    }\n\n    return this._getCache(name, getter);\n  }\n\n  _getCanvasCache() {\n    return this._cache.get(CANVAS);\n  }\n\n  _clearSelfAndDescendantCache(attr) {\n    this._clearCache(attr);\n\n    if (attr === ABSOLUTE_TRANSFORM) {\n      this.fire('absoluteTransformChange');\n    }\n  }\n\n  clearCache() {\n    if (this._cache.has(CANVAS)) {\n      const {\n        scene,\n        filter,\n        hit\n      } = this._cache.get(CANVAS);\n\n      Util_1.Util.releaseCanvas(scene, filter, hit);\n\n      this._cache.delete(CANVAS);\n    }\n\n    this._clearSelfAndDescendantCache();\n\n    this._requestDraw();\n\n    return this;\n  }\n\n  cache(config) {\n    var conf = config || {};\n    var rect = {};\n\n    if (conf.x === undefined || conf.y === undefined || conf.width === undefined || conf.height === undefined) {\n      rect = this.getClientRect({\n        skipTransform: true,\n        relativeTo: this.getParent() || undefined\n      });\n    }\n\n    var width = Math.ceil(conf.width || rect.width),\n        height = Math.ceil(conf.height || rect.height),\n        pixelRatio = conf.pixelRatio,\n        x = conf.x === undefined ? Math.floor(rect.x) : conf.x,\n        y = conf.y === undefined ? Math.floor(rect.y) : conf.y,\n        offset = conf.offset || 0,\n        drawBorder = conf.drawBorder || false,\n        hitCanvasPixelRatio = conf.hitCanvasPixelRatio || 1;\n\n    if (!width || !height) {\n      Util_1.Util.error('Can not cache the node. Width or height of the node equals 0. Caching is skipped.');\n      return;\n    }\n\n    const extraPaddingX = Math.abs(Math.round(rect.x) - x) > 0.5 ? 1 : 0;\n    const extraPaddingY = Math.abs(Math.round(rect.y) - y) > 0.5 ? 1 : 0;\n    width += offset * 2 + extraPaddingX;\n    height += offset * 2 + extraPaddingY;\n    x -= offset;\n    y -= offset;\n    var cachedSceneCanvas = new Canvas_1.SceneCanvas({\n      pixelRatio: pixelRatio,\n      width: width,\n      height: height\n    }),\n        cachedFilterCanvas = new Canvas_1.SceneCanvas({\n      pixelRatio: pixelRatio,\n      width: 0,\n      height: 0,\n      willReadFrequently: true\n    }),\n        cachedHitCanvas = new Canvas_1.HitCanvas({\n      pixelRatio: hitCanvasPixelRatio,\n      width: width,\n      height: height\n    }),\n        sceneContext = cachedSceneCanvas.getContext(),\n        hitContext = cachedHitCanvas.getContext();\n    cachedHitCanvas.isCache = true;\n    cachedSceneCanvas.isCache = true;\n\n    this._cache.delete(CANVAS);\n\n    this._filterUpToDate = false;\n\n    if (conf.imageSmoothingEnabled === false) {\n      cachedSceneCanvas.getContext()._context.imageSmoothingEnabled = false;\n      cachedFilterCanvas.getContext()._context.imageSmoothingEnabled = false;\n    }\n\n    sceneContext.save();\n    hitContext.save();\n    sceneContext.translate(-x, -y);\n    hitContext.translate(-x, -y);\n    this._isUnderCache = true;\n\n    this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY);\n\n    this._clearSelfAndDescendantCache(ABSOLUTE_SCALE);\n\n    this.drawScene(cachedSceneCanvas, this);\n    this.drawHit(cachedHitCanvas, this);\n    this._isUnderCache = false;\n    sceneContext.restore();\n    hitContext.restore();\n\n    if (drawBorder) {\n      sceneContext.save();\n      sceneContext.beginPath();\n      sceneContext.rect(0, 0, width, height);\n      sceneContext.closePath();\n      sceneContext.setAttr('strokeStyle', 'red');\n      sceneContext.setAttr('lineWidth', 5);\n      sceneContext.stroke();\n      sceneContext.restore();\n    }\n\n    this._cache.set(CANVAS, {\n      scene: cachedSceneCanvas,\n      filter: cachedFilterCanvas,\n      hit: cachedHitCanvas,\n      x: x,\n      y: y\n    });\n\n    this._requestDraw();\n\n    return this;\n  }\n\n  isCached() {\n    return this._cache.has(CANVAS);\n  }\n\n  getClientRect(config) {\n    throw new Error('abstract \"getClientRect\" method call');\n  }\n\n  _transformedRect(rect, top) {\n    var points = [{\n      x: rect.x,\n      y: rect.y\n    }, {\n      x: rect.x + rect.width,\n      y: rect.y\n    }, {\n      x: rect.x + rect.width,\n      y: rect.y + rect.height\n    }, {\n      x: rect.x,\n      y: rect.y + rect.height\n    }];\n    var minX = Infinity,\n        minY = Infinity,\n        maxX = -Infinity,\n        maxY = -Infinity;\n    var trans = this.getAbsoluteTransform(top);\n    points.forEach(function (point) {\n      var transformed = trans.point(point);\n\n      if (minX === undefined) {\n        minX = maxX = transformed.x;\n        minY = maxY = transformed.y;\n      }\n\n      minX = Math.min(minX, transformed.x);\n      minY = Math.min(minY, transformed.y);\n      maxX = Math.max(maxX, transformed.x);\n      maxY = Math.max(maxY, transformed.y);\n    });\n    return {\n      x: minX,\n      y: minY,\n      width: maxX - minX,\n      height: maxY - minY\n    };\n  }\n\n  _drawCachedSceneCanvas(context) {\n    context.save();\n\n    context._applyOpacity(this);\n\n    context._applyGlobalCompositeOperation(this);\n\n    const canvasCache = this._getCanvasCache();\n\n    context.translate(canvasCache.x, canvasCache.y);\n\n    var cacheCanvas = this._getCachedSceneCanvas();\n\n    var ratio = cacheCanvas.pixelRatio;\n    context.drawImage(cacheCanvas._canvas, 0, 0, cacheCanvas.width / ratio, cacheCanvas.height / ratio);\n    context.restore();\n  }\n\n  _drawCachedHitCanvas(context) {\n    var canvasCache = this._getCanvasCache(),\n        hitCanvas = canvasCache.hit;\n\n    context.save();\n    context.translate(canvasCache.x, canvasCache.y);\n    context.drawImage(hitCanvas._canvas, 0, 0, hitCanvas.width / hitCanvas.pixelRatio, hitCanvas.height / hitCanvas.pixelRatio);\n    context.restore();\n  }\n\n  _getCachedSceneCanvas() {\n    var filters = this.filters(),\n        cachedCanvas = this._getCanvasCache(),\n        sceneCanvas = cachedCanvas.scene,\n        filterCanvas = cachedCanvas.filter,\n        filterContext = filterCanvas.getContext(),\n        len,\n        imageData,\n        n,\n        filter;\n\n    if (filters) {\n      if (!this._filterUpToDate) {\n        var ratio = sceneCanvas.pixelRatio;\n        filterCanvas.setSize(sceneCanvas.width / sceneCanvas.pixelRatio, sceneCanvas.height / sceneCanvas.pixelRatio);\n\n        try {\n          len = filters.length;\n          filterContext.clear();\n          filterContext.drawImage(sceneCanvas._canvas, 0, 0, sceneCanvas.getWidth() / ratio, sceneCanvas.getHeight() / ratio);\n          imageData = filterContext.getImageData(0, 0, filterCanvas.getWidth(), filterCanvas.getHeight());\n\n          for (n = 0; n < len; n++) {\n            filter = filters[n];\n\n            if (typeof filter !== 'function') {\n              Util_1.Util.error('Filter should be type of function, but got ' + typeof filter + ' instead. Please check correct filters');\n              continue;\n            }\n\n            filter.call(this, imageData);\n            filterContext.putImageData(imageData, 0, 0);\n          }\n        } catch (e) {\n          Util_1.Util.error('Unable to apply filter. ' + e.message + ' This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.');\n        }\n\n        this._filterUpToDate = true;\n      }\n\n      return filterCanvas;\n    }\n\n    return sceneCanvas;\n  }\n\n  on(evtStr, handler) {\n    this._cache && this._cache.delete(ALL_LISTENERS);\n\n    if (arguments.length === 3) {\n      return this._delegate.apply(this, arguments);\n    }\n\n    var events = evtStr.split(SPACE),\n        len = events.length,\n        n,\n        event,\n        parts,\n        baseEvent,\n        name;\n\n    for (n = 0; n < len; n++) {\n      event = events[n];\n      parts = event.split('.');\n      baseEvent = parts[0];\n      name = parts[1] || '';\n\n      if (!this.eventListeners[baseEvent]) {\n        this.eventListeners[baseEvent] = [];\n      }\n\n      this.eventListeners[baseEvent].push({\n        name: name,\n        handler: handler\n      });\n    }\n\n    return this;\n  }\n\n  off(evtStr, callback) {\n    var events = (evtStr || '').split(SPACE),\n        len = events.length,\n        n,\n        t,\n        event,\n        parts,\n        baseEvent,\n        name;\n    this._cache && this._cache.delete(ALL_LISTENERS);\n\n    if (!evtStr) {\n      for (t in this.eventListeners) {\n        this._off(t);\n      }\n    }\n\n    for (n = 0; n < len; n++) {\n      event = events[n];\n      parts = event.split('.');\n      baseEvent = parts[0];\n      name = parts[1];\n\n      if (baseEvent) {\n        if (this.eventListeners[baseEvent]) {\n          this._off(baseEvent, name, callback);\n        }\n      } else {\n        for (t in this.eventListeners) {\n          this._off(t, name, callback);\n        }\n      }\n    }\n\n    return this;\n  }\n\n  dispatchEvent(evt) {\n    var e = {\n      target: this,\n      type: evt.type,\n      evt: evt\n    };\n    this.fire(evt.type, e);\n    return this;\n  }\n\n  addEventListener(type, handler) {\n    this.on(type, function (evt) {\n      handler.call(this, evt.evt);\n    });\n    return this;\n  }\n\n  removeEventListener(type) {\n    this.off(type);\n    return this;\n  }\n\n  _delegate(event, selector, handler) {\n    var stopNode = this;\n    this.on(event, function (evt) {\n      var targets = evt.target.findAncestors(selector, true, stopNode);\n\n      for (var i = 0; i < targets.length; i++) {\n        evt = Util_1.Util.cloneObject(evt);\n        evt.currentTarget = targets[i];\n        handler.call(targets[i], evt);\n      }\n    });\n  }\n\n  remove() {\n    if (this.isDragging()) {\n      this.stopDrag();\n    }\n\n    DragAndDrop_1.DD._dragElements.delete(this._id);\n\n    this._remove();\n\n    return this;\n  }\n\n  _clearCaches() {\n    this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n\n    this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY);\n\n    this._clearSelfAndDescendantCache(ABSOLUTE_SCALE);\n\n    this._clearSelfAndDescendantCache(STAGE);\n\n    this._clearSelfAndDescendantCache(VISIBLE);\n\n    this._clearSelfAndDescendantCache(LISTENING);\n  }\n\n  _remove() {\n    this._clearCaches();\n\n    var parent = this.getParent();\n\n    if (parent && parent.children) {\n      parent.children.splice(this.index, 1);\n\n      parent._setChildrenIndices();\n\n      this.parent = null;\n    }\n  }\n\n  destroy() {\n    this.remove();\n    this.clearCache();\n    return this;\n  }\n\n  getAttr(attr) {\n    var method = 'get' + Util_1.Util._capitalize(attr);\n\n    if (Util_1.Util._isFunction(this[method])) {\n      return this[method]();\n    }\n\n    return this.attrs[attr];\n  }\n\n  getAncestors() {\n    var parent = this.getParent(),\n        ancestors = [];\n\n    while (parent) {\n      ancestors.push(parent);\n      parent = parent.getParent();\n    }\n\n    return ancestors;\n  }\n\n  getAttrs() {\n    return this.attrs || {};\n  }\n\n  setAttrs(config) {\n    this._batchTransformChanges(() => {\n      var key, method;\n\n      if (!config) {\n        return this;\n      }\n\n      for (key in config) {\n        if (key === CHILDREN) {\n          continue;\n        }\n\n        method = SET + Util_1.Util._capitalize(key);\n\n        if (Util_1.Util._isFunction(this[method])) {\n          this[method](config[key]);\n        } else {\n          this._setAttr(key, config[key]);\n        }\n      }\n    });\n\n    return this;\n  }\n\n  isListening() {\n    return this._getCache(LISTENING, this._isListening);\n  }\n\n  _isListening(relativeTo) {\n    const listening = this.listening();\n\n    if (!listening) {\n      return false;\n    }\n\n    const parent = this.getParent();\n\n    if (parent && parent !== relativeTo && this !== relativeTo) {\n      return parent._isListening(relativeTo);\n    } else {\n      return true;\n    }\n  }\n\n  isVisible() {\n    return this._getCache(VISIBLE, this._isVisible);\n  }\n\n  _isVisible(relativeTo) {\n    const visible = this.visible();\n\n    if (!visible) {\n      return false;\n    }\n\n    const parent = this.getParent();\n\n    if (parent && parent !== relativeTo && this !== relativeTo) {\n      return parent._isVisible(relativeTo);\n    } else {\n      return true;\n    }\n  }\n\n  shouldDrawHit(top) {\n    let skipDragCheck = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;\n\n    if (top) {\n      return this._isVisible(top) && this._isListening(top);\n    }\n\n    var layer = this.getLayer();\n    var layerUnderDrag = false;\n\n    DragAndDrop_1.DD._dragElements.forEach(elem => {\n      if (elem.dragStatus !== 'dragging') {\n        return;\n      } else if (elem.node.nodeType === 'Stage') {\n        layerUnderDrag = true;\n      } else if (elem.node.getLayer() === layer) {\n        layerUnderDrag = true;\n      }\n    });\n\n    var dragSkip = !skipDragCheck && !Global_1.Konva.hitOnDragEnabled && (layerUnderDrag || Global_1.Konva.isTransforming());\n    return this.isListening() && this.isVisible() && !dragSkip;\n  }\n\n  show() {\n    this.visible(true);\n    return this;\n  }\n\n  hide() {\n    this.visible(false);\n    return this;\n  }\n\n  getZIndex() {\n    return this.index || 0;\n  }\n\n  getAbsoluteZIndex() {\n    var depth = this.getDepth(),\n        that = this,\n        index = 0,\n        nodes,\n        len,\n        n,\n        child;\n\n    function addChildren(children) {\n      nodes = [];\n      len = children.length;\n\n      for (n = 0; n < len; n++) {\n        child = children[n];\n        index++;\n\n        if (child.nodeType !== SHAPE) {\n          nodes = nodes.concat(child.getChildren().slice());\n        }\n\n        if (child._id === that._id) {\n          n = len;\n        }\n      }\n\n      if (nodes.length > 0 && nodes[0].getDepth() <= depth) {\n        addChildren(nodes);\n      }\n    }\n\n    const stage = this.getStage();\n\n    if (that.nodeType !== UPPER_STAGE && stage) {\n      addChildren(stage.getChildren());\n    }\n\n    return index;\n  }\n\n  getDepth() {\n    var depth = 0,\n        parent = this.parent;\n\n    while (parent) {\n      depth++;\n      parent = parent.parent;\n    }\n\n    return depth;\n  }\n\n  _batchTransformChanges(func) {\n    this._batchingTransformChange = true;\n    func();\n    this._batchingTransformChange = false;\n\n    if (this._needClearTransformCache) {\n      this._clearCache(TRANSFORM);\n\n      this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n    }\n\n    this._needClearTransformCache = false;\n  }\n\n  setPosition(pos) {\n    this._batchTransformChanges(() => {\n      this.x(pos.x);\n      this.y(pos.y);\n    });\n\n    return this;\n  }\n\n  getPosition() {\n    return {\n      x: this.x(),\n      y: this.y()\n    };\n  }\n\n  getRelativePointerPosition() {\n    const stage = this.getStage();\n\n    if (!stage) {\n      return null;\n    }\n\n    var pos = stage.getPointerPosition();\n\n    if (!pos) {\n      return null;\n    }\n\n    var transform = this.getAbsoluteTransform().copy();\n    transform.invert();\n    return transform.point(pos);\n  }\n\n  getAbsolutePosition(top) {\n    let haveCachedParent = false;\n    let parent = this.parent;\n\n    while (parent) {\n      if (parent.isCached()) {\n        haveCachedParent = true;\n        break;\n      }\n\n      parent = parent.parent;\n    }\n\n    if (haveCachedParent && !top) {\n      top = true;\n    }\n\n    var absoluteMatrix = this.getAbsoluteTransform(top).getMatrix(),\n        absoluteTransform = new Util_1.Transform(),\n        offset = this.offset();\n    absoluteTransform.m = absoluteMatrix.slice();\n    absoluteTransform.translate(offset.x, offset.y);\n    return absoluteTransform.getTranslation();\n  }\n\n  setAbsolutePosition(pos) {\n    const {\n      x,\n      y,\n      ...origTrans\n    } = this._clearTransform();\n\n    this.attrs.x = x;\n    this.attrs.y = y;\n\n    this._clearCache(TRANSFORM);\n\n    var it = this._getAbsoluteTransform().copy();\n\n    it.invert();\n    it.translate(pos.x, pos.y);\n    pos = {\n      x: this.attrs.x + it.getTranslation().x,\n      y: this.attrs.y + it.getTranslation().y\n    };\n\n    this._setTransform(origTrans);\n\n    this.setPosition({\n      x: pos.x,\n      y: pos.y\n    });\n\n    this._clearCache(TRANSFORM);\n\n    this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n\n    return this;\n  }\n\n  _setTransform(trans) {\n    var key;\n\n    for (key in trans) {\n      this.attrs[key] = trans[key];\n    }\n  }\n\n  _clearTransform() {\n    var trans = {\n      x: this.x(),\n      y: this.y(),\n      rotation: this.rotation(),\n      scaleX: this.scaleX(),\n      scaleY: this.scaleY(),\n      offsetX: this.offsetX(),\n      offsetY: this.offsetY(),\n      skewX: this.skewX(),\n      skewY: this.skewY()\n    };\n    this.attrs.x = 0;\n    this.attrs.y = 0;\n    this.attrs.rotation = 0;\n    this.attrs.scaleX = 1;\n    this.attrs.scaleY = 1;\n    this.attrs.offsetX = 0;\n    this.attrs.offsetY = 0;\n    this.attrs.skewX = 0;\n    this.attrs.skewY = 0;\n    return trans;\n  }\n\n  move(change) {\n    var changeX = change.x,\n        changeY = change.y,\n        x = this.x(),\n        y = this.y();\n\n    if (changeX !== undefined) {\n      x += changeX;\n    }\n\n    if (changeY !== undefined) {\n      y += changeY;\n    }\n\n    this.setPosition({\n      x: x,\n      y: y\n    });\n    return this;\n  }\n\n  _eachAncestorReverse(func, top) {\n    var family = [],\n        parent = this.getParent(),\n        len,\n        n;\n\n    if (top && top._id === this._id) {\n      return;\n    }\n\n    family.unshift(this);\n\n    while (parent && (!top || parent._id !== top._id)) {\n      family.unshift(parent);\n      parent = parent.parent;\n    }\n\n    len = family.length;\n\n    for (n = 0; n < len; n++) {\n      func(family[n]);\n    }\n  }\n\n  rotate(theta) {\n    this.rotation(this.rotation() + theta);\n    return this;\n  }\n\n  moveToTop() {\n    if (!this.parent) {\n      Util_1.Util.warn('Node has no parent. moveToTop function is ignored.');\n      return false;\n    }\n\n    var index = this.index,\n        len = this.parent.getChildren().length;\n\n    if (index < len - 1) {\n      this.parent.children.splice(index, 1);\n      this.parent.children.push(this);\n\n      this.parent._setChildrenIndices();\n\n      return true;\n    }\n\n    return false;\n  }\n\n  moveUp() {\n    if (!this.parent) {\n      Util_1.Util.warn('Node has no parent. moveUp function is ignored.');\n      return false;\n    }\n\n    var index = this.index,\n        len = this.parent.getChildren().length;\n\n    if (index < len - 1) {\n      this.parent.children.splice(index, 1);\n      this.parent.children.splice(index + 1, 0, this);\n\n      this.parent._setChildrenIndices();\n\n      return true;\n    }\n\n    return false;\n  }\n\n  moveDown() {\n    if (!this.parent) {\n      Util_1.Util.warn('Node has no parent. moveDown function is ignored.');\n      return false;\n    }\n\n    var index = this.index;\n\n    if (index > 0) {\n      this.parent.children.splice(index, 1);\n      this.parent.children.splice(index - 1, 0, this);\n\n      this.parent._setChildrenIndices();\n\n      return true;\n    }\n\n    return false;\n  }\n\n  moveToBottom() {\n    if (!this.parent) {\n      Util_1.Util.warn('Node has no parent. moveToBottom function is ignored.');\n      return false;\n    }\n\n    var index = this.index;\n\n    if (index > 0) {\n      this.parent.children.splice(index, 1);\n      this.parent.children.unshift(this);\n\n      this.parent._setChildrenIndices();\n\n      return true;\n    }\n\n    return false;\n  }\n\n  setZIndex(zIndex) {\n    if (!this.parent) {\n      Util_1.Util.warn('Node has no parent. zIndex parameter is ignored.');\n      return this;\n    }\n\n    if (zIndex < 0 || zIndex >= this.parent.children.length) {\n      Util_1.Util.warn('Unexpected value ' + zIndex + ' for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to ' + (this.parent.children.length - 1) + '.');\n    }\n\n    var index = this.index;\n    this.parent.children.splice(index, 1);\n    this.parent.children.splice(zIndex, 0, this);\n\n    this.parent._setChildrenIndices();\n\n    return this;\n  }\n\n  getAbsoluteOpacity() {\n    return this._getCache(ABSOLUTE_OPACITY, this._getAbsoluteOpacity);\n  }\n\n  _getAbsoluteOpacity() {\n    var absOpacity = this.opacity();\n    var parent = this.getParent();\n\n    if (parent && !parent._isUnderCache) {\n      absOpacity *= parent.getAbsoluteOpacity();\n    }\n\n    return absOpacity;\n  }\n\n  moveTo(newContainer) {\n    if (this.getParent() !== newContainer) {\n      this._remove();\n\n      newContainer.add(this);\n    }\n\n    return this;\n  }\n\n  toObject() {\n    var attrs = this.getAttrs(),\n        key,\n        val,\n        getter,\n        defaultValue,\n        nonPlainObject;\n    const obj = {\n      attrs: {},\n      className: this.getClassName()\n    };\n\n    for (key in attrs) {\n      val = attrs[key];\n      nonPlainObject = Util_1.Util.isObject(val) && !Util_1.Util._isPlainObject(val) && !Util_1.Util._isArray(val);\n\n      if (nonPlainObject) {\n        continue;\n      }\n\n      getter = typeof this[key] === 'function' && this[key];\n      delete attrs[key];\n      defaultValue = getter ? getter.call(this) : null;\n      attrs[key] = val;\n\n      if (defaultValue !== val) {\n        obj.attrs[key] = val;\n      }\n    }\n\n    return Util_1.Util._prepareToStringify(obj);\n  }\n\n  toJSON() {\n    return JSON.stringify(this.toObject());\n  }\n\n  getParent() {\n    return this.parent;\n  }\n\n  findAncestors(selector, includeSelf, stopNode) {\n    var res = [];\n\n    if (includeSelf && this._isMatch(selector)) {\n      res.push(this);\n    }\n\n    var ancestor = this.parent;\n\n    while (ancestor) {\n      if (ancestor === stopNode) {\n        return res;\n      }\n\n      if (ancestor._isMatch(selector)) {\n        res.push(ancestor);\n      }\n\n      ancestor = ancestor.parent;\n    }\n\n    return res;\n  }\n\n  isAncestorOf(node) {\n    return false;\n  }\n\n  findAncestor(selector, includeSelf, stopNode) {\n    return this.findAncestors(selector, includeSelf, stopNode)[0];\n  }\n\n  _isMatch(selector) {\n    if (!selector) {\n      return false;\n    }\n\n    if (typeof selector === 'function') {\n      return selector(this);\n    }\n\n    var selectorArr = selector.replace(/ /g, '').split(','),\n        len = selectorArr.length,\n        n,\n        sel;\n\n    for (n = 0; n < len; n++) {\n      sel = selectorArr[n];\n\n      if (!Util_1.Util.isValidSelector(sel)) {\n        Util_1.Util.warn('Selector \"' + sel + '\" is invalid. Allowed selectors examples are \"#foo\", \".bar\" or \"Group\".');\n        Util_1.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like \"Triangle\".');\n        Util_1.Util.warn('Konva is awesome, right?');\n      }\n\n      if (sel.charAt(0) === '#') {\n        if (this.id() === sel.slice(1)) {\n          return true;\n        }\n      } else if (sel.charAt(0) === '.') {\n        if (this.hasName(sel.slice(1))) {\n          return true;\n        }\n      } else if (this.className === sel || this.nodeType === sel) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  getLayer() {\n    var parent = this.getParent();\n    return parent ? parent.getLayer() : null;\n  }\n\n  getStage() {\n    return this._getCache(STAGE, this._getStage);\n  }\n\n  _getStage() {\n    var parent = this.getParent();\n\n    if (parent) {\n      return parent.getStage();\n    } else {\n      return null;\n    }\n  }\n\n  fire(eventType) {\n    let evt = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    let bubble = arguments.length > 2 ? arguments[2] : undefined;\n    evt.target = evt.target || this;\n\n    if (bubble) {\n      this._fireAndBubble(eventType, evt);\n    } else {\n      this._fire(eventType, evt);\n    }\n\n    return this;\n  }\n\n  getAbsoluteTransform(top) {\n    if (top) {\n      return this._getAbsoluteTransform(top);\n    } else {\n      return this._getCache(ABSOLUTE_TRANSFORM, this._getAbsoluteTransform);\n    }\n  }\n\n  _getAbsoluteTransform(top) {\n    var at;\n\n    if (top) {\n      at = new Util_1.Transform();\n\n      this._eachAncestorReverse(function (node) {\n        var transformsEnabled = node.transformsEnabled();\n\n        if (transformsEnabled === 'all') {\n          at.multiply(node.getTransform());\n        } else if (transformsEnabled === 'position') {\n          at.translate(node.x() - node.offsetX(), node.y() - node.offsetY());\n        }\n      }, top);\n\n      return at;\n    } else {\n      at = this._cache.get(ABSOLUTE_TRANSFORM) || new Util_1.Transform();\n\n      if (this.parent) {\n        this.parent.getAbsoluteTransform().copyInto(at);\n      } else {\n        at.reset();\n      }\n\n      var transformsEnabled = this.transformsEnabled();\n\n      if (transformsEnabled === 'all') {\n        at.multiply(this.getTransform());\n      } else if (transformsEnabled === 'position') {\n        const x = this.attrs.x || 0;\n        const y = this.attrs.y || 0;\n        const offsetX = this.attrs.offsetX || 0;\n        const offsetY = this.attrs.offsetY || 0;\n        at.translate(x - offsetX, y - offsetY);\n      }\n\n      at.dirty = false;\n      return at;\n    }\n  }\n\n  getAbsoluteScale(top) {\n    var parent = this;\n\n    while (parent) {\n      if (parent._isUnderCache) {\n        top = parent;\n      }\n\n      parent = parent.getParent();\n    }\n\n    const transform = this.getAbsoluteTransform(top);\n    const attrs = transform.decompose();\n    return {\n      x: attrs.scaleX,\n      y: attrs.scaleY\n    };\n  }\n\n  getAbsoluteRotation() {\n    return this.getAbsoluteTransform().decompose().rotation;\n  }\n\n  getTransform() {\n    return this._getCache(TRANSFORM, this._getTransform);\n  }\n\n  _getTransform() {\n    var _a, _b;\n\n    var m = this._cache.get(TRANSFORM) || new Util_1.Transform();\n    m.reset();\n    var x = this.x(),\n        y = this.y(),\n        rotation = Global_1.Konva.getAngle(this.rotation()),\n        scaleX = (_a = this.attrs.scaleX) !== null && _a !== void 0 ? _a : 1,\n        scaleY = (_b = this.attrs.scaleY) !== null && _b !== void 0 ? _b : 1,\n        skewX = this.attrs.skewX || 0,\n        skewY = this.attrs.skewY || 0,\n        offsetX = this.attrs.offsetX || 0,\n        offsetY = this.attrs.offsetY || 0;\n\n    if (x !== 0 || y !== 0) {\n      m.translate(x, y);\n    }\n\n    if (rotation !== 0) {\n      m.rotate(rotation);\n    }\n\n    if (skewX !== 0 || skewY !== 0) {\n      m.skew(skewX, skewY);\n    }\n\n    if (scaleX !== 1 || scaleY !== 1) {\n      m.scale(scaleX, scaleY);\n    }\n\n    if (offsetX !== 0 || offsetY !== 0) {\n      m.translate(-1 * offsetX, -1 * offsetY);\n    }\n\n    m.dirty = false;\n    return m;\n  }\n\n  clone(obj) {\n    var attrs = Util_1.Util.cloneObject(this.attrs),\n        key,\n        allListeners,\n        len,\n        n,\n        listener;\n\n    for (key in obj) {\n      attrs[key] = obj[key];\n    }\n\n    var node = new this.constructor(attrs);\n\n    for (key in this.eventListeners) {\n      allListeners = this.eventListeners[key];\n      len = allListeners.length;\n\n      for (n = 0; n < len; n++) {\n        listener = allListeners[n];\n\n        if (listener.name.indexOf(KONVA) < 0) {\n          if (!node.eventListeners[key]) {\n            node.eventListeners[key] = [];\n          }\n\n          node.eventListeners[key].push(listener);\n        }\n      }\n    }\n\n    return node;\n  }\n\n  _toKonvaCanvas(config) {\n    config = config || {};\n    var box = this.getClientRect();\n    var stage = this.getStage(),\n        x = config.x !== undefined ? config.x : Math.floor(box.x),\n        y = config.y !== undefined ? config.y : Math.floor(box.y),\n        pixelRatio = config.pixelRatio || 1,\n        canvas = new Canvas_1.SceneCanvas({\n      width: config.width || Math.ceil(box.width) || (stage ? stage.width() : 0),\n      height: config.height || Math.ceil(box.height) || (stage ? stage.height() : 0),\n      pixelRatio: pixelRatio\n    }),\n        context = canvas.getContext();\n    const bufferCanvas = new Canvas_1.SceneCanvas({\n      width: canvas.width / canvas.pixelRatio + Math.abs(x),\n      height: canvas.height / canvas.pixelRatio + Math.abs(y),\n      pixelRatio: canvas.pixelRatio\n    });\n\n    if (config.imageSmoothingEnabled === false) {\n      context._context.imageSmoothingEnabled = false;\n    }\n\n    context.save();\n\n    if (x || y) {\n      context.translate(-1 * x, -1 * y);\n    }\n\n    this.drawScene(canvas, undefined, bufferCanvas);\n    context.restore();\n    return canvas;\n  }\n\n  toCanvas(config) {\n    return this._toKonvaCanvas(config)._canvas;\n  }\n\n  toDataURL(config) {\n    config = config || {};\n    var mimeType = config.mimeType || null,\n        quality = config.quality || null;\n\n    var url = this._toKonvaCanvas(config).toDataURL(mimeType, quality);\n\n    if (config.callback) {\n      config.callback(url);\n    }\n\n    return url;\n  }\n\n  toImage(config) {\n    return new Promise((resolve, reject) => {\n      try {\n        const callback = config === null || config === void 0 ? void 0 : config.callback;\n        if (callback) delete config.callback;\n\n        Util_1.Util._urlToImage(this.toDataURL(config), function (img) {\n          resolve(img);\n          callback === null || callback === void 0 ? void 0 : callback(img);\n        });\n      } catch (err) {\n        reject(err);\n      }\n    });\n  }\n\n  toBlob(config) {\n    return new Promise((resolve, reject) => {\n      try {\n        const callback = config === null || config === void 0 ? void 0 : config.callback;\n        if (callback) delete config.callback;\n        this.toCanvas(config).toBlob(blob => {\n          resolve(blob);\n          callback === null || callback === void 0 ? void 0 : callback(blob);\n        }, config === null || config === void 0 ? void 0 : config.mimeType, config === null || config === void 0 ? void 0 : config.quality);\n      } catch (err) {\n        reject(err);\n      }\n    });\n  }\n\n  setSize(size) {\n    this.width(size.width);\n    this.height(size.height);\n    return this;\n  }\n\n  getSize() {\n    return {\n      width: this.width(),\n      height: this.height()\n    };\n  }\n\n  getClassName() {\n    return this.className || this.nodeType;\n  }\n\n  getType() {\n    return this.nodeType;\n  }\n\n  getDragDistance() {\n    if (this.attrs.dragDistance !== undefined) {\n      return this.attrs.dragDistance;\n    } else if (this.parent) {\n      return this.parent.getDragDistance();\n    } else {\n      return Global_1.Konva.dragDistance;\n    }\n  }\n\n  _off(type, name, callback) {\n    var evtListeners = this.eventListeners[type],\n        i,\n        evtName,\n        handler;\n\n    for (i = 0; i < evtListeners.length; i++) {\n      evtName = evtListeners[i].name;\n      handler = evtListeners[i].handler;\n\n      if ((evtName !== 'konva' || name === 'konva') && (!name || evtName === name) && (!callback || callback === handler)) {\n        evtListeners.splice(i, 1);\n\n        if (evtListeners.length === 0) {\n          delete this.eventListeners[type];\n          break;\n        }\n\n        i--;\n      }\n    }\n  }\n\n  _fireChangeEvent(attr, oldVal, newVal) {\n    this._fire(attr + CHANGE, {\n      oldVal: oldVal,\n      newVal: newVal\n    });\n  }\n\n  addName(name) {\n    if (!this.hasName(name)) {\n      var oldName = this.name();\n      var newName = oldName ? oldName + ' ' + name : name;\n      this.name(newName);\n    }\n\n    return this;\n  }\n\n  hasName(name) {\n    if (!name) {\n      return false;\n    }\n\n    const fullName = this.name();\n\n    if (!fullName) {\n      return false;\n    }\n\n    var names = (fullName || '').split(/\\s/g);\n    return names.indexOf(name) !== -1;\n  }\n\n  removeName(name) {\n    var names = (this.name() || '').split(/\\s/g);\n    var index = names.indexOf(name);\n\n    if (index !== -1) {\n      names.splice(index, 1);\n      this.name(names.join(' '));\n    }\n\n    return this;\n  }\n\n  setAttr(attr, val) {\n    var func = this[SET + Util_1.Util._capitalize(attr)];\n\n    if (Util_1.Util._isFunction(func)) {\n      func.call(this, val);\n    } else {\n      this._setAttr(attr, val);\n    }\n\n    return this;\n  }\n\n  _requestDraw() {\n    if (Global_1.Konva.autoDrawEnabled) {\n      const drawNode = this.getLayer() || this.getStage();\n      drawNode === null || drawNode === void 0 ? void 0 : drawNode.batchDraw();\n    }\n  }\n\n  _setAttr(key, val) {\n    var oldVal = this.attrs[key];\n\n    if (oldVal === val && !Util_1.Util.isObject(val)) {\n      return;\n    }\n\n    if (val === undefined || val === null) {\n      delete this.attrs[key];\n    } else {\n      this.attrs[key] = val;\n    }\n\n    if (this._shouldFireChangeEvents) {\n      this._fireChangeEvent(key, oldVal, val);\n    }\n\n    this._requestDraw();\n  }\n\n  _setComponentAttr(key, component, val) {\n    var oldVal;\n\n    if (val !== undefined) {\n      oldVal = this.attrs[key];\n\n      if (!oldVal) {\n        this.attrs[key] = this.getAttr(key);\n      }\n\n      this.attrs[key][component] = val;\n\n      this._fireChangeEvent(key, oldVal, val);\n    }\n  }\n\n  _fireAndBubble(eventType, evt, compareShape) {\n    if (evt && this.nodeType === SHAPE) {\n      evt.target = this;\n    }\n\n    var shouldStop = (eventType === MOUSEENTER || eventType === MOUSELEAVE) && (compareShape && (this === compareShape || this.isAncestorOf && this.isAncestorOf(compareShape)) || this.nodeType === 'Stage' && !compareShape);\n\n    if (!shouldStop) {\n      this._fire(eventType, evt);\n\n      var stopBubble = (eventType === MOUSEENTER || eventType === MOUSELEAVE) && compareShape && compareShape.isAncestorOf && compareShape.isAncestorOf(this) && !compareShape.isAncestorOf(this.parent);\n\n      if ((evt && !evt.cancelBubble || !evt) && this.parent && this.parent.isListening() && !stopBubble) {\n        if (compareShape && compareShape.parent) {\n          this._fireAndBubble.call(this.parent, eventType, evt, compareShape);\n        } else {\n          this._fireAndBubble.call(this.parent, eventType, evt);\n        }\n      }\n    }\n  }\n\n  _getProtoListeners(eventType) {\n    var _a, _b, _c;\n\n    const allListeners = (_a = this._cache.get(ALL_LISTENERS)) !== null && _a !== void 0 ? _a : {};\n    let events = allListeners === null || allListeners === void 0 ? void 0 : allListeners[eventType];\n\n    if (events === undefined) {\n      events = [];\n      let obj = Object.getPrototypeOf(this);\n\n      while (obj) {\n        const hierarchyEvents = (_c = (_b = obj.eventListeners) === null || _b === void 0 ? void 0 : _b[eventType]) !== null && _c !== void 0 ? _c : [];\n        events.push(...hierarchyEvents);\n        obj = Object.getPrototypeOf(obj);\n      }\n\n      allListeners[eventType] = events;\n\n      this._cache.set(ALL_LISTENERS, allListeners);\n    }\n\n    return events;\n  }\n\n  _fire(eventType, evt) {\n    evt = evt || {};\n    evt.currentTarget = this;\n    evt.type = eventType;\n\n    const topListeners = this._getProtoListeners(eventType);\n\n    if (topListeners) {\n      for (var i = 0; i < topListeners.length; i++) {\n        topListeners[i].handler.call(this, evt);\n      }\n    }\n\n    const selfListeners = this.eventListeners[eventType];\n\n    if (selfListeners) {\n      for (var i = 0; i < selfListeners.length; i++) {\n        selfListeners[i].handler.call(this, evt);\n      }\n    }\n  }\n\n  draw() {\n    this.drawScene();\n    this.drawHit();\n    return this;\n  }\n\n  _createDragElement(evt) {\n    var pointerId = evt ? evt.pointerId : undefined;\n    var stage = this.getStage();\n    var ap = this.getAbsolutePosition();\n\n    if (!stage) {\n      return;\n    }\n\n    var pos = stage._getPointerById(pointerId) || stage._changedPointerPositions[0] || ap;\n\n    DragAndDrop_1.DD._dragElements.set(this._id, {\n      node: this,\n      startPointerPos: pos,\n      offset: {\n        x: pos.x - ap.x,\n        y: pos.y - ap.y\n      },\n      dragStatus: 'ready',\n      pointerId\n    });\n  }\n\n  startDrag(evt) {\n    let bubbleEvent = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n\n    if (!DragAndDrop_1.DD._dragElements.has(this._id)) {\n      this._createDragElement(evt);\n    }\n\n    const elem = DragAndDrop_1.DD._dragElements.get(this._id);\n\n    elem.dragStatus = 'dragging';\n    this.fire('dragstart', {\n      type: 'dragstart',\n      target: this,\n      evt: evt && evt.evt\n    }, bubbleEvent);\n  }\n\n  _setDragPosition(evt, elem) {\n    const pos = this.getStage()._getPointerById(elem.pointerId);\n\n    if (!pos) {\n      return;\n    }\n\n    var newNodePos = {\n      x: pos.x - elem.offset.x,\n      y: pos.y - elem.offset.y\n    };\n    var dbf = this.dragBoundFunc();\n\n    if (dbf !== undefined) {\n      const bounded = dbf.call(this, newNodePos, evt);\n\n      if (!bounded) {\n        Util_1.Util.warn('dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.');\n      } else {\n        newNodePos = bounded;\n      }\n    }\n\n    if (!this._lastPos || this._lastPos.x !== newNodePos.x || this._lastPos.y !== newNodePos.y) {\n      this.setAbsolutePosition(newNodePos);\n\n      this._requestDraw();\n    }\n\n    this._lastPos = newNodePos;\n  }\n\n  stopDrag(evt) {\n    const elem = DragAndDrop_1.DD._dragElements.get(this._id);\n\n    if (elem) {\n      elem.dragStatus = 'stopped';\n    }\n\n    DragAndDrop_1.DD._endDragBefore(evt);\n\n    DragAndDrop_1.DD._endDragAfter(evt);\n  }\n\n  setDraggable(draggable) {\n    this._setAttr('draggable', draggable);\n\n    this._dragChange();\n  }\n\n  isDragging() {\n    const elem = DragAndDrop_1.DD._dragElements.get(this._id);\n\n    return elem ? elem.dragStatus === 'dragging' : false;\n  }\n\n  _listenDrag() {\n    this._dragCleanup();\n\n    this.on('mousedown.konva touchstart.konva', function (evt) {\n      var shouldCheckButton = evt.evt['button'] !== undefined;\n      var canDrag = !shouldCheckButton || Global_1.Konva.dragButtons.indexOf(evt.evt['button']) >= 0;\n\n      if (!canDrag) {\n        return;\n      }\n\n      if (this.isDragging()) {\n        return;\n      }\n\n      var hasDraggingChild = false;\n\n      DragAndDrop_1.DD._dragElements.forEach(elem => {\n        if (this.isAncestorOf(elem.node)) {\n          hasDraggingChild = true;\n        }\n      });\n\n      if (!hasDraggingChild) {\n        this._createDragElement(evt);\n      }\n    });\n  }\n\n  _dragChange() {\n    if (this.attrs.draggable) {\n      this._listenDrag();\n    } else {\n      this._dragCleanup();\n\n      var stage = this.getStage();\n\n      if (!stage) {\n        return;\n      }\n\n      const dragElement = DragAndDrop_1.DD._dragElements.get(this._id);\n\n      const isDragging = dragElement && dragElement.dragStatus === 'dragging';\n      const isReady = dragElement && dragElement.dragStatus === 'ready';\n\n      if (isDragging) {\n        this.stopDrag();\n      } else if (isReady) {\n        DragAndDrop_1.DD._dragElements.delete(this._id);\n      }\n    }\n  }\n\n  _dragCleanup() {\n    this.off('mousedown.konva');\n    this.off('touchstart.konva');\n  }\n\n  isClientRectOnScreen() {\n    let margin = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {\n      x: 0,\n      y: 0\n    };\n    const stage = this.getStage();\n\n    if (!stage) {\n      return false;\n    }\n\n    const screenRect = {\n      x: -margin.x,\n      y: -margin.y,\n      width: stage.width() + 2 * margin.x,\n      height: stage.height() + 2 * margin.y\n    };\n    return Util_1.Util.haveIntersection(screenRect, this.getClientRect());\n  }\n\n  static create(data, container) {\n    if (Util_1.Util._isString(data)) {\n      data = JSON.parse(data);\n    }\n\n    return this._createNode(data, container);\n  }\n\n  static _createNode(obj, container) {\n    var className = Node.prototype.getClassName.call(obj),\n        children = obj.children,\n        no,\n        len,\n        n;\n\n    if (container) {\n      obj.attrs.container = container;\n    }\n\n    if (!Global_1.Konva[className]) {\n      Util_1.Util.warn('Can not find a node with class name \"' + className + '\". Fallback to \"Shape\".');\n      className = 'Shape';\n    }\n\n    const Class = Global_1.Konva[className];\n    no = new Class(obj.attrs);\n\n    if (children) {\n      len = children.length;\n\n      for (n = 0; n < len; n++) {\n        no.add(Node._createNode(children[n]));\n      }\n    }\n\n    return no;\n  }\n\n}\n\nexports.Node = Node;\nNode.prototype.nodeType = 'Node';\nNode.prototype._attrsAffectingSize = [];\nNode.prototype.eventListeners = {};\nNode.prototype.on.call(Node.prototype, TRANSFORM_CHANGE_STR, function () {\n  if (this._batchingTransformChange) {\n    this._needClearTransformCache = true;\n    return;\n  }\n\n  this._clearCache(TRANSFORM);\n\n  this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n});\nNode.prototype.on.call(Node.prototype, 'visibleChange.konva', function () {\n  this._clearSelfAndDescendantCache(VISIBLE);\n});\nNode.prototype.on.call(Node.prototype, 'listeningChange.konva', function () {\n  this._clearSelfAndDescendantCache(LISTENING);\n});\nNode.prototype.on.call(Node.prototype, 'opacityChange.konva', function () {\n  this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY);\n});\nconst addGetterSetter = Factory_1.Factory.addGetterSetter;\naddGetterSetter(Node, 'zIndex');\naddGetterSetter(Node, 'absolutePosition');\naddGetterSetter(Node, 'position');\naddGetterSetter(Node, 'x', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'y', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'globalCompositeOperation', 'source-over', (0, Validators_1.getStringValidator)());\naddGetterSetter(Node, 'opacity', 1, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'name', '', (0, Validators_1.getStringValidator)());\naddGetterSetter(Node, 'id', '', (0, Validators_1.getStringValidator)());\naddGetterSetter(Node, 'rotation', 0, (0, Validators_1.getNumberValidator)());\nFactory_1.Factory.addComponentsGetterSetter(Node, 'scale', ['x', 'y']);\naddGetterSetter(Node, 'scaleX', 1, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'scaleY', 1, (0, Validators_1.getNumberValidator)());\nFactory_1.Factory.addComponentsGetterSetter(Node, 'skew', ['x', 'y']);\naddGetterSetter(Node, 'skewX', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'skewY', 0, (0, Validators_1.getNumberValidator)());\nFactory_1.Factory.addComponentsGetterSetter(Node, 'offset', ['x', 'y']);\naddGetterSetter(Node, 'offsetX', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'offsetY', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'dragDistance', null, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'width', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'height', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'listening', true, (0, Validators_1.getBooleanValidator)());\naddGetterSetter(Node, 'preventDefault', true, (0, Validators_1.getBooleanValidator)());\naddGetterSetter(Node, 'filters', null, function (val) {\n  this._filterUpToDate = false;\n  return val;\n});\naddGetterSetter(Node, 'visible', true, (0, Validators_1.getBooleanValidator)());\naddGetterSetter(Node, 'transformsEnabled', 'all', (0, Validators_1.getStringValidator)());\naddGetterSetter(Node, 'size');\naddGetterSetter(Node, 'dragBoundFunc');\naddGetterSetter(Node, 'draggable', false, (0, Validators_1.getBooleanValidator)());\nFactory_1.Factory.backCompat(Node, {\n  rotateDeg: 'rotate',\n  setRotationDeg: 'setRotation',\n  getRotationDeg: 'getRotation'\n});","map":{"version":3,"names":["Object","defineProperty","exports","value","Node","Util_1","require","Factory_1","Canvas_1","Global_1","DragAndDrop_1","Validators_1","ABSOLUTE_OPACITY","ALL_LISTENERS","ABSOLUTE_TRANSFORM","ABSOLUTE_SCALE","CANVAS","CHANGE","CHILDREN","KONVA","LISTENING","MOUSEENTER","MOUSELEAVE","NAME","SET","SHAPE","SPACE","STAGE","TRANSFORM","UPPER_STAGE","VISIBLE","TRANSFORM_CHANGE_STR","join","idCounter","constructor","config","_id","eventListeners","attrs","index","_allEventListeners","parent","_cache","Map","_attachedDepsListeners","_lastPos","_batchingTransformChange","_needClearTransformCache","_filterUpToDate","_isUnderCache","_dragEventId","_shouldFireChangeEvents","setAttrs","hasChildren","_clearCache","attr","get","dirty","delete","clear","_getCache","privateGetter","cache","isTransform","invalid","undefined","call","set","_calculate","name","deps","getter","depsString","map","dep","on","_getCanvasCache","_clearSelfAndDescendantCache","fire","clearCache","has","scene","filter","hit","Util","releaseCanvas","_requestDraw","conf","rect","x","y","width","height","getClientRect","skipTransform","relativeTo","getParent","Math","ceil","pixelRatio","floor","offset","drawBorder","hitCanvasPixelRatio","error","extraPaddingX","abs","round","extraPaddingY","cachedSceneCanvas","SceneCanvas","cachedFilterCanvas","willReadFrequently","cachedHitCanvas","HitCanvas","sceneContext","getContext","hitContext","isCache","imageSmoothingEnabled","_context","save","translate","drawScene","drawHit","restore","beginPath","closePath","setAttr","stroke","isCached","Error","_transformedRect","top","points","minX","Infinity","minY","maxX","maxY","trans","getAbsoluteTransform","forEach","point","transformed","min","max","_drawCachedSceneCanvas","context","_applyOpacity","_applyGlobalCompositeOperation","canvasCache","cacheCanvas","_getCachedSceneCanvas","ratio","drawImage","_canvas","_drawCachedHitCanvas","hitCanvas","filters","cachedCanvas","sceneCanvas","filterCanvas","filterContext","len","imageData","n","setSize","length","getWidth","getHeight","getImageData","putImageData","e","message","evtStr","handler","arguments","_delegate","apply","events","split","event","parts","baseEvent","push","off","callback","t","_off","dispatchEvent","evt","target","type","addEventListener","removeEventListener","selector","stopNode","targets","findAncestors","i","cloneObject","currentTarget","remove","isDragging","stopDrag","DD","_dragElements","_remove","_clearCaches","children","splice","_setChildrenIndices","destroy","getAttr","method","_capitalize","_isFunction","getAncestors","ancestors","getAttrs","_batchTransformChanges","key","_setAttr","isListening","_isListening","listening","isVisible","_isVisible","visible","shouldDrawHit","skipDragCheck","layer","getLayer","layerUnderDrag","elem","dragStatus","node","nodeType","dragSkip","Konva","hitOnDragEnabled","isTransforming","show","hide","getZIndex","getAbsoluteZIndex","depth","getDepth","that","nodes","child","addChildren","concat","getChildren","slice","stage","getStage","func","setPosition","pos","getPosition","getRelativePointerPosition","getPointerPosition","transform","copy","invert","getAbsolutePosition","haveCachedParent","absoluteMatrix","getMatrix","absoluteTransform","Transform","m","getTranslation","setAbsolutePosition","origTrans","_clearTransform","it","_getAbsoluteTransform","_setTransform","rotation","scaleX","scaleY","offsetX","offsetY","skewX","skewY","move","change","changeX","changeY","_eachAncestorReverse","family","unshift","rotate","theta","moveToTop","warn","moveUp","moveDown","moveToBottom","setZIndex","zIndex","getAbsoluteOpacity","_getAbsoluteOpacity","absOpacity","opacity","moveTo","newContainer","add","toObject","val","defaultValue","nonPlainObject","obj","className","getClassName","isObject","_isPlainObject","_isArray","_prepareToStringify","toJSON","JSON","stringify","includeSelf","res","_isMatch","ancestor","isAncestorOf","findAncestor","selectorArr","replace","sel","isValidSelector","charAt","id","hasName","_getStage","eventType","bubble","_fireAndBubble","_fire","at","transformsEnabled","multiply","getTransform","copyInto","reset","getAbsoluteScale","decompose","getAbsoluteRotation","_getTransform","_a","_b","getAngle","skew","scale","clone","allListeners","listener","indexOf","_toKonvaCanvas","box","canvas","bufferCanvas","toCanvas","toDataURL","mimeType","quality","url","toImage","Promise","resolve","reject","_urlToImage","img","err","toBlob","blob","size","getSize","getType","getDragDistance","dragDistance","evtListeners","evtName","_fireChangeEvent","oldVal","newVal","addName","oldName","newName","fullName","names","removeName","autoDrawEnabled","drawNode","batchDraw","_setComponentAttr","component","compareShape","shouldStop","stopBubble","cancelBubble","_getProtoListeners","_c","getPrototypeOf","hierarchyEvents","topListeners","selfListeners","draw","_createDragElement","pointerId","ap","_getPointerById","_changedPointerPositions","startPointerPos","startDrag","bubbleEvent","_setDragPosition","newNodePos","dbf","dragBoundFunc","bounded","_endDragBefore","_endDragAfter","setDraggable","draggable","_dragChange","_listenDrag","_dragCleanup","shouldCheckButton","canDrag","dragButtons","hasDraggingChild","dragElement","isReady","isClientRectOnScreen","margin","screenRect","haveIntersection","create","data","container","_isString","parse","_createNode","prototype","no","Class","_attrsAffectingSize","addGetterSetter","Factory","getNumberValidator","getStringValidator","addComponentsGetterSetter","getBooleanValidator","backCompat","rotateDeg","setRotationDeg","getRotationDeg"],"sources":["D:/screenshort-extension/image-editor-react/node_modules/konva/lib/Node.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Node = void 0;\nconst Util_1 = require(\"./Util\");\nconst Factory_1 = require(\"./Factory\");\nconst Canvas_1 = require(\"./Canvas\");\nconst Global_1 = require(\"./Global\");\nconst DragAndDrop_1 = require(\"./DragAndDrop\");\nconst Validators_1 = require(\"./Validators\");\nvar ABSOLUTE_OPACITY = 'absoluteOpacity', ALL_LISTENERS = 'allEventListeners', ABSOLUTE_TRANSFORM = 'absoluteTransform', ABSOLUTE_SCALE = 'absoluteScale', CANVAS = 'canvas', CHANGE = 'Change', CHILDREN = 'children', KONVA = 'konva', LISTENING = 'listening', MOUSEENTER = 'mouseenter', MOUSELEAVE = 'mouseleave', NAME = 'name', SET = 'set', SHAPE = 'Shape', SPACE = ' ', STAGE = 'stage', TRANSFORM = 'transform', UPPER_STAGE = 'Stage', VISIBLE = 'visible', TRANSFORM_CHANGE_STR = [\n    'xChange.konva',\n    'yChange.konva',\n    'scaleXChange.konva',\n    'scaleYChange.konva',\n    'skewXChange.konva',\n    'skewYChange.konva',\n    'rotationChange.konva',\n    'offsetXChange.konva',\n    'offsetYChange.konva',\n    'transformsEnabledChange.konva',\n].join(SPACE);\nlet idCounter = 1;\nclass Node {\n    constructor(config) {\n        this._id = idCounter++;\n        this.eventListeners = {};\n        this.attrs = {};\n        this.index = 0;\n        this._allEventListeners = null;\n        this.parent = null;\n        this._cache = new Map();\n        this._attachedDepsListeners = new Map();\n        this._lastPos = null;\n        this._batchingTransformChange = false;\n        this._needClearTransformCache = false;\n        this._filterUpToDate = false;\n        this._isUnderCache = false;\n        this._dragEventId = null;\n        this._shouldFireChangeEvents = false;\n        this.setAttrs(config);\n        this._shouldFireChangeEvents = true;\n    }\n    hasChildren() {\n        return false;\n    }\n    _clearCache(attr) {\n        if ((attr === TRANSFORM || attr === ABSOLUTE_TRANSFORM) &&\n            this._cache.get(attr)) {\n            this._cache.get(attr).dirty = true;\n        }\n        else if (attr) {\n            this._cache.delete(attr);\n        }\n        else {\n            this._cache.clear();\n        }\n    }\n    _getCache(attr, privateGetter) {\n        var cache = this._cache.get(attr);\n        var isTransform = attr === TRANSFORM || attr === ABSOLUTE_TRANSFORM;\n        var invalid = cache === undefined || (isTransform && cache.dirty === true);\n        if (invalid) {\n            cache = privateGetter.call(this);\n            this._cache.set(attr, cache);\n        }\n        return cache;\n    }\n    _calculate(name, deps, getter) {\n        if (!this._attachedDepsListeners.get(name)) {\n            const depsString = deps.map((dep) => dep + 'Change.konva').join(SPACE);\n            this.on(depsString, () => {\n                this._clearCache(name);\n            });\n            this._attachedDepsListeners.set(name, true);\n        }\n        return this._getCache(name, getter);\n    }\n    _getCanvasCache() {\n        return this._cache.get(CANVAS);\n    }\n    _clearSelfAndDescendantCache(attr) {\n        this._clearCache(attr);\n        if (attr === ABSOLUTE_TRANSFORM) {\n            this.fire('absoluteTransformChange');\n        }\n    }\n    clearCache() {\n        if (this._cache.has(CANVAS)) {\n            const { scene, filter, hit } = this._cache.get(CANVAS);\n            Util_1.Util.releaseCanvas(scene, filter, hit);\n            this._cache.delete(CANVAS);\n        }\n        this._clearSelfAndDescendantCache();\n        this._requestDraw();\n        return this;\n    }\n    cache(config) {\n        var conf = config || {};\n        var rect = {};\n        if (conf.x === undefined ||\n            conf.y === undefined ||\n            conf.width === undefined ||\n            conf.height === undefined) {\n            rect = this.getClientRect({\n                skipTransform: true,\n                relativeTo: this.getParent() || undefined,\n            });\n        }\n        var width = Math.ceil(conf.width || rect.width), height = Math.ceil(conf.height || rect.height), pixelRatio = conf.pixelRatio, x = conf.x === undefined ? Math.floor(rect.x) : conf.x, y = conf.y === undefined ? Math.floor(rect.y) : conf.y, offset = conf.offset || 0, drawBorder = conf.drawBorder || false, hitCanvasPixelRatio = conf.hitCanvasPixelRatio || 1;\n        if (!width || !height) {\n            Util_1.Util.error('Can not cache the node. Width or height of the node equals 0. Caching is skipped.');\n            return;\n        }\n        const extraPaddingX = Math.abs(Math.round(rect.x) - x) > 0.5 ? 1 : 0;\n        const extraPaddingY = Math.abs(Math.round(rect.y) - y) > 0.5 ? 1 : 0;\n        width += offset * 2 + extraPaddingX;\n        height += offset * 2 + extraPaddingY;\n        x -= offset;\n        y -= offset;\n        var cachedSceneCanvas = new Canvas_1.SceneCanvas({\n            pixelRatio: pixelRatio,\n            width: width,\n            height: height,\n        }), cachedFilterCanvas = new Canvas_1.SceneCanvas({\n            pixelRatio: pixelRatio,\n            width: 0,\n            height: 0,\n            willReadFrequently: true,\n        }), cachedHitCanvas = new Canvas_1.HitCanvas({\n            pixelRatio: hitCanvasPixelRatio,\n            width: width,\n            height: height,\n        }), sceneContext = cachedSceneCanvas.getContext(), hitContext = cachedHitCanvas.getContext();\n        cachedHitCanvas.isCache = true;\n        cachedSceneCanvas.isCache = true;\n        this._cache.delete(CANVAS);\n        this._filterUpToDate = false;\n        if (conf.imageSmoothingEnabled === false) {\n            cachedSceneCanvas.getContext()._context.imageSmoothingEnabled = false;\n            cachedFilterCanvas.getContext()._context.imageSmoothingEnabled = false;\n        }\n        sceneContext.save();\n        hitContext.save();\n        sceneContext.translate(-x, -y);\n        hitContext.translate(-x, -y);\n        this._isUnderCache = true;\n        this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY);\n        this._clearSelfAndDescendantCache(ABSOLUTE_SCALE);\n        this.drawScene(cachedSceneCanvas, this);\n        this.drawHit(cachedHitCanvas, this);\n        this._isUnderCache = false;\n        sceneContext.restore();\n        hitContext.restore();\n        if (drawBorder) {\n            sceneContext.save();\n            sceneContext.beginPath();\n            sceneContext.rect(0, 0, width, height);\n            sceneContext.closePath();\n            sceneContext.setAttr('strokeStyle', 'red');\n            sceneContext.setAttr('lineWidth', 5);\n            sceneContext.stroke();\n            sceneContext.restore();\n        }\n        this._cache.set(CANVAS, {\n            scene: cachedSceneCanvas,\n            filter: cachedFilterCanvas,\n            hit: cachedHitCanvas,\n            x: x,\n            y: y,\n        });\n        this._requestDraw();\n        return this;\n    }\n    isCached() {\n        return this._cache.has(CANVAS);\n    }\n    getClientRect(config) {\n        throw new Error('abstract \"getClientRect\" method call');\n    }\n    _transformedRect(rect, top) {\n        var points = [\n            { x: rect.x, y: rect.y },\n            { x: rect.x + rect.width, y: rect.y },\n            { x: rect.x + rect.width, y: rect.y + rect.height },\n            { x: rect.x, y: rect.y + rect.height },\n        ];\n        var minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;\n        var trans = this.getAbsoluteTransform(top);\n        points.forEach(function (point) {\n            var transformed = trans.point(point);\n            if (minX === undefined) {\n                minX = maxX = transformed.x;\n                minY = maxY = transformed.y;\n            }\n            minX = Math.min(minX, transformed.x);\n            minY = Math.min(minY, transformed.y);\n            maxX = Math.max(maxX, transformed.x);\n            maxY = Math.max(maxY, transformed.y);\n        });\n        return {\n            x: minX,\n            y: minY,\n            width: maxX - minX,\n            height: maxY - minY,\n        };\n    }\n    _drawCachedSceneCanvas(context) {\n        context.save();\n        context._applyOpacity(this);\n        context._applyGlobalCompositeOperation(this);\n        const canvasCache = this._getCanvasCache();\n        context.translate(canvasCache.x, canvasCache.y);\n        var cacheCanvas = this._getCachedSceneCanvas();\n        var ratio = cacheCanvas.pixelRatio;\n        context.drawImage(cacheCanvas._canvas, 0, 0, cacheCanvas.width / ratio, cacheCanvas.height / ratio);\n        context.restore();\n    }\n    _drawCachedHitCanvas(context) {\n        var canvasCache = this._getCanvasCache(), hitCanvas = canvasCache.hit;\n        context.save();\n        context.translate(canvasCache.x, canvasCache.y);\n        context.drawImage(hitCanvas._canvas, 0, 0, hitCanvas.width / hitCanvas.pixelRatio, hitCanvas.height / hitCanvas.pixelRatio);\n        context.restore();\n    }\n    _getCachedSceneCanvas() {\n        var filters = this.filters(), cachedCanvas = this._getCanvasCache(), sceneCanvas = cachedCanvas.scene, filterCanvas = cachedCanvas.filter, filterContext = filterCanvas.getContext(), len, imageData, n, filter;\n        if (filters) {\n            if (!this._filterUpToDate) {\n                var ratio = sceneCanvas.pixelRatio;\n                filterCanvas.setSize(sceneCanvas.width / sceneCanvas.pixelRatio, sceneCanvas.height / sceneCanvas.pixelRatio);\n                try {\n                    len = filters.length;\n                    filterContext.clear();\n                    filterContext.drawImage(sceneCanvas._canvas, 0, 0, sceneCanvas.getWidth() / ratio, sceneCanvas.getHeight() / ratio);\n                    imageData = filterContext.getImageData(0, 0, filterCanvas.getWidth(), filterCanvas.getHeight());\n                    for (n = 0; n < len; n++) {\n                        filter = filters[n];\n                        if (typeof filter !== 'function') {\n                            Util_1.Util.error('Filter should be type of function, but got ' +\n                                typeof filter +\n                                ' instead. Please check correct filters');\n                            continue;\n                        }\n                        filter.call(this, imageData);\n                        filterContext.putImageData(imageData, 0, 0);\n                    }\n                }\n                catch (e) {\n                    Util_1.Util.error('Unable to apply filter. ' +\n                        e.message +\n                        ' This post my help you https://konvajs.org/docs/posts/Tainted_Canvas.html.');\n                }\n                this._filterUpToDate = true;\n            }\n            return filterCanvas;\n        }\n        return sceneCanvas;\n    }\n    on(evtStr, handler) {\n        this._cache && this._cache.delete(ALL_LISTENERS);\n        if (arguments.length === 3) {\n            return this._delegate.apply(this, arguments);\n        }\n        var events = evtStr.split(SPACE), len = events.length, n, event, parts, baseEvent, name;\n        for (n = 0; n < len; n++) {\n            event = events[n];\n            parts = event.split('.');\n            baseEvent = parts[0];\n            name = parts[1] || '';\n            if (!this.eventListeners[baseEvent]) {\n                this.eventListeners[baseEvent] = [];\n            }\n            this.eventListeners[baseEvent].push({\n                name: name,\n                handler: handler,\n            });\n        }\n        return this;\n    }\n    off(evtStr, callback) {\n        var events = (evtStr || '').split(SPACE), len = events.length, n, t, event, parts, baseEvent, name;\n        this._cache && this._cache.delete(ALL_LISTENERS);\n        if (!evtStr) {\n            for (t in this.eventListeners) {\n                this._off(t);\n            }\n        }\n        for (n = 0; n < len; n++) {\n            event = events[n];\n            parts = event.split('.');\n            baseEvent = parts[0];\n            name = parts[1];\n            if (baseEvent) {\n                if (this.eventListeners[baseEvent]) {\n                    this._off(baseEvent, name, callback);\n                }\n            }\n            else {\n                for (t in this.eventListeners) {\n                    this._off(t, name, callback);\n                }\n            }\n        }\n        return this;\n    }\n    dispatchEvent(evt) {\n        var e = {\n            target: this,\n            type: evt.type,\n            evt: evt,\n        };\n        this.fire(evt.type, e);\n        return this;\n    }\n    addEventListener(type, handler) {\n        this.on(type, function (evt) {\n            handler.call(this, evt.evt);\n        });\n        return this;\n    }\n    removeEventListener(type) {\n        this.off(type);\n        return this;\n    }\n    _delegate(event, selector, handler) {\n        var stopNode = this;\n        this.on(event, function (evt) {\n            var targets = evt.target.findAncestors(selector, true, stopNode);\n            for (var i = 0; i < targets.length; i++) {\n                evt = Util_1.Util.cloneObject(evt);\n                evt.currentTarget = targets[i];\n                handler.call(targets[i], evt);\n            }\n        });\n    }\n    remove() {\n        if (this.isDragging()) {\n            this.stopDrag();\n        }\n        DragAndDrop_1.DD._dragElements.delete(this._id);\n        this._remove();\n        return this;\n    }\n    _clearCaches() {\n        this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n        this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY);\n        this._clearSelfAndDescendantCache(ABSOLUTE_SCALE);\n        this._clearSelfAndDescendantCache(STAGE);\n        this._clearSelfAndDescendantCache(VISIBLE);\n        this._clearSelfAndDescendantCache(LISTENING);\n    }\n    _remove() {\n        this._clearCaches();\n        var parent = this.getParent();\n        if (parent && parent.children) {\n            parent.children.splice(this.index, 1);\n            parent._setChildrenIndices();\n            this.parent = null;\n        }\n    }\n    destroy() {\n        this.remove();\n        this.clearCache();\n        return this;\n    }\n    getAttr(attr) {\n        var method = 'get' + Util_1.Util._capitalize(attr);\n        if (Util_1.Util._isFunction(this[method])) {\n            return this[method]();\n        }\n        return this.attrs[attr];\n    }\n    getAncestors() {\n        var parent = this.getParent(), ancestors = [];\n        while (parent) {\n            ancestors.push(parent);\n            parent = parent.getParent();\n        }\n        return ancestors;\n    }\n    getAttrs() {\n        return (this.attrs || {});\n    }\n    setAttrs(config) {\n        this._batchTransformChanges(() => {\n            var key, method;\n            if (!config) {\n                return this;\n            }\n            for (key in config) {\n                if (key === CHILDREN) {\n                    continue;\n                }\n                method = SET + Util_1.Util._capitalize(key);\n                if (Util_1.Util._isFunction(this[method])) {\n                    this[method](config[key]);\n                }\n                else {\n                    this._setAttr(key, config[key]);\n                }\n            }\n        });\n        return this;\n    }\n    isListening() {\n        return this._getCache(LISTENING, this._isListening);\n    }\n    _isListening(relativeTo) {\n        const listening = this.listening();\n        if (!listening) {\n            return false;\n        }\n        const parent = this.getParent();\n        if (parent && parent !== relativeTo && this !== relativeTo) {\n            return parent._isListening(relativeTo);\n        }\n        else {\n            return true;\n        }\n    }\n    isVisible() {\n        return this._getCache(VISIBLE, this._isVisible);\n    }\n    _isVisible(relativeTo) {\n        const visible = this.visible();\n        if (!visible) {\n            return false;\n        }\n        const parent = this.getParent();\n        if (parent && parent !== relativeTo && this !== relativeTo) {\n            return parent._isVisible(relativeTo);\n        }\n        else {\n            return true;\n        }\n    }\n    shouldDrawHit(top, skipDragCheck = false) {\n        if (top) {\n            return this._isVisible(top) && this._isListening(top);\n        }\n        var layer = this.getLayer();\n        var layerUnderDrag = false;\n        DragAndDrop_1.DD._dragElements.forEach((elem) => {\n            if (elem.dragStatus !== 'dragging') {\n                return;\n            }\n            else if (elem.node.nodeType === 'Stage') {\n                layerUnderDrag = true;\n            }\n            else if (elem.node.getLayer() === layer) {\n                layerUnderDrag = true;\n            }\n        });\n        var dragSkip = !skipDragCheck &&\n            !Global_1.Konva.hitOnDragEnabled &&\n            (layerUnderDrag || Global_1.Konva.isTransforming());\n        return this.isListening() && this.isVisible() && !dragSkip;\n    }\n    show() {\n        this.visible(true);\n        return this;\n    }\n    hide() {\n        this.visible(false);\n        return this;\n    }\n    getZIndex() {\n        return this.index || 0;\n    }\n    getAbsoluteZIndex() {\n        var depth = this.getDepth(), that = this, index = 0, nodes, len, n, child;\n        function addChildren(children) {\n            nodes = [];\n            len = children.length;\n            for (n = 0; n < len; n++) {\n                child = children[n];\n                index++;\n                if (child.nodeType !== SHAPE) {\n                    nodes = nodes.concat(child.getChildren().slice());\n                }\n                if (child._id === that._id) {\n                    n = len;\n                }\n            }\n            if (nodes.length > 0 && nodes[0].getDepth() <= depth) {\n                addChildren(nodes);\n            }\n        }\n        const stage = this.getStage();\n        if (that.nodeType !== UPPER_STAGE && stage) {\n            addChildren(stage.getChildren());\n        }\n        return index;\n    }\n    getDepth() {\n        var depth = 0, parent = this.parent;\n        while (parent) {\n            depth++;\n            parent = parent.parent;\n        }\n        return depth;\n    }\n    _batchTransformChanges(func) {\n        this._batchingTransformChange = true;\n        func();\n        this._batchingTransformChange = false;\n        if (this._needClearTransformCache) {\n            this._clearCache(TRANSFORM);\n            this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n        }\n        this._needClearTransformCache = false;\n    }\n    setPosition(pos) {\n        this._batchTransformChanges(() => {\n            this.x(pos.x);\n            this.y(pos.y);\n        });\n        return this;\n    }\n    getPosition() {\n        return {\n            x: this.x(),\n            y: this.y(),\n        };\n    }\n    getRelativePointerPosition() {\n        const stage = this.getStage();\n        if (!stage) {\n            return null;\n        }\n        var pos = stage.getPointerPosition();\n        if (!pos) {\n            return null;\n        }\n        var transform = this.getAbsoluteTransform().copy();\n        transform.invert();\n        return transform.point(pos);\n    }\n    getAbsolutePosition(top) {\n        let haveCachedParent = false;\n        let parent = this.parent;\n        while (parent) {\n            if (parent.isCached()) {\n                haveCachedParent = true;\n                break;\n            }\n            parent = parent.parent;\n        }\n        if (haveCachedParent && !top) {\n            top = true;\n        }\n        var absoluteMatrix = this.getAbsoluteTransform(top).getMatrix(), absoluteTransform = new Util_1.Transform(), offset = this.offset();\n        absoluteTransform.m = absoluteMatrix.slice();\n        absoluteTransform.translate(offset.x, offset.y);\n        return absoluteTransform.getTranslation();\n    }\n    setAbsolutePosition(pos) {\n        const { x, y, ...origTrans } = this._clearTransform();\n        this.attrs.x = x;\n        this.attrs.y = y;\n        this._clearCache(TRANSFORM);\n        var it = this._getAbsoluteTransform().copy();\n        it.invert();\n        it.translate(pos.x, pos.y);\n        pos = {\n            x: this.attrs.x + it.getTranslation().x,\n            y: this.attrs.y + it.getTranslation().y,\n        };\n        this._setTransform(origTrans);\n        this.setPosition({ x: pos.x, y: pos.y });\n        this._clearCache(TRANSFORM);\n        this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n        return this;\n    }\n    _setTransform(trans) {\n        var key;\n        for (key in trans) {\n            this.attrs[key] = trans[key];\n        }\n    }\n    _clearTransform() {\n        var trans = {\n            x: this.x(),\n            y: this.y(),\n            rotation: this.rotation(),\n            scaleX: this.scaleX(),\n            scaleY: this.scaleY(),\n            offsetX: this.offsetX(),\n            offsetY: this.offsetY(),\n            skewX: this.skewX(),\n            skewY: this.skewY(),\n        };\n        this.attrs.x = 0;\n        this.attrs.y = 0;\n        this.attrs.rotation = 0;\n        this.attrs.scaleX = 1;\n        this.attrs.scaleY = 1;\n        this.attrs.offsetX = 0;\n        this.attrs.offsetY = 0;\n        this.attrs.skewX = 0;\n        this.attrs.skewY = 0;\n        return trans;\n    }\n    move(change) {\n        var changeX = change.x, changeY = change.y, x = this.x(), y = this.y();\n        if (changeX !== undefined) {\n            x += changeX;\n        }\n        if (changeY !== undefined) {\n            y += changeY;\n        }\n        this.setPosition({ x: x, y: y });\n        return this;\n    }\n    _eachAncestorReverse(func, top) {\n        var family = [], parent = this.getParent(), len, n;\n        if (top && top._id === this._id) {\n            return;\n        }\n        family.unshift(this);\n        while (parent && (!top || parent._id !== top._id)) {\n            family.unshift(parent);\n            parent = parent.parent;\n        }\n        len = family.length;\n        for (n = 0; n < len; n++) {\n            func(family[n]);\n        }\n    }\n    rotate(theta) {\n        this.rotation(this.rotation() + theta);\n        return this;\n    }\n    moveToTop() {\n        if (!this.parent) {\n            Util_1.Util.warn('Node has no parent. moveToTop function is ignored.');\n            return false;\n        }\n        var index = this.index, len = this.parent.getChildren().length;\n        if (index < len - 1) {\n            this.parent.children.splice(index, 1);\n            this.parent.children.push(this);\n            this.parent._setChildrenIndices();\n            return true;\n        }\n        return false;\n    }\n    moveUp() {\n        if (!this.parent) {\n            Util_1.Util.warn('Node has no parent. moveUp function is ignored.');\n            return false;\n        }\n        var index = this.index, len = this.parent.getChildren().length;\n        if (index < len - 1) {\n            this.parent.children.splice(index, 1);\n            this.parent.children.splice(index + 1, 0, this);\n            this.parent._setChildrenIndices();\n            return true;\n        }\n        return false;\n    }\n    moveDown() {\n        if (!this.parent) {\n            Util_1.Util.warn('Node has no parent. moveDown function is ignored.');\n            return false;\n        }\n        var index = this.index;\n        if (index > 0) {\n            this.parent.children.splice(index, 1);\n            this.parent.children.splice(index - 1, 0, this);\n            this.parent._setChildrenIndices();\n            return true;\n        }\n        return false;\n    }\n    moveToBottom() {\n        if (!this.parent) {\n            Util_1.Util.warn('Node has no parent. moveToBottom function is ignored.');\n            return false;\n        }\n        var index = this.index;\n        if (index > 0) {\n            this.parent.children.splice(index, 1);\n            this.parent.children.unshift(this);\n            this.parent._setChildrenIndices();\n            return true;\n        }\n        return false;\n    }\n    setZIndex(zIndex) {\n        if (!this.parent) {\n            Util_1.Util.warn('Node has no parent. zIndex parameter is ignored.');\n            return this;\n        }\n        if (zIndex < 0 || zIndex >= this.parent.children.length) {\n            Util_1.Util.warn('Unexpected value ' +\n                zIndex +\n                ' for zIndex property. zIndex is just index of a node in children of its parent. Expected value is from 0 to ' +\n                (this.parent.children.length - 1) +\n                '.');\n        }\n        var index = this.index;\n        this.parent.children.splice(index, 1);\n        this.parent.children.splice(zIndex, 0, this);\n        this.parent._setChildrenIndices();\n        return this;\n    }\n    getAbsoluteOpacity() {\n        return this._getCache(ABSOLUTE_OPACITY, this._getAbsoluteOpacity);\n    }\n    _getAbsoluteOpacity() {\n        var absOpacity = this.opacity();\n        var parent = this.getParent();\n        if (parent && !parent._isUnderCache) {\n            absOpacity *= parent.getAbsoluteOpacity();\n        }\n        return absOpacity;\n    }\n    moveTo(newContainer) {\n        if (this.getParent() !== newContainer) {\n            this._remove();\n            newContainer.add(this);\n        }\n        return this;\n    }\n    toObject() {\n        var attrs = this.getAttrs(), key, val, getter, defaultValue, nonPlainObject;\n        const obj = {\n            attrs: {},\n            className: this.getClassName(),\n        };\n        for (key in attrs) {\n            val = attrs[key];\n            nonPlainObject =\n                Util_1.Util.isObject(val) && !Util_1.Util._isPlainObject(val) && !Util_1.Util._isArray(val);\n            if (nonPlainObject) {\n                continue;\n            }\n            getter = typeof this[key] === 'function' && this[key];\n            delete attrs[key];\n            defaultValue = getter ? getter.call(this) : null;\n            attrs[key] = val;\n            if (defaultValue !== val) {\n                obj.attrs[key] = val;\n            }\n        }\n        return Util_1.Util._prepareToStringify(obj);\n    }\n    toJSON() {\n        return JSON.stringify(this.toObject());\n    }\n    getParent() {\n        return this.parent;\n    }\n    findAncestors(selector, includeSelf, stopNode) {\n        var res = [];\n        if (includeSelf && this._isMatch(selector)) {\n            res.push(this);\n        }\n        var ancestor = this.parent;\n        while (ancestor) {\n            if (ancestor === stopNode) {\n                return res;\n            }\n            if (ancestor._isMatch(selector)) {\n                res.push(ancestor);\n            }\n            ancestor = ancestor.parent;\n        }\n        return res;\n    }\n    isAncestorOf(node) {\n        return false;\n    }\n    findAncestor(selector, includeSelf, stopNode) {\n        return this.findAncestors(selector, includeSelf, stopNode)[0];\n    }\n    _isMatch(selector) {\n        if (!selector) {\n            return false;\n        }\n        if (typeof selector === 'function') {\n            return selector(this);\n        }\n        var selectorArr = selector.replace(/ /g, '').split(','), len = selectorArr.length, n, sel;\n        for (n = 0; n < len; n++) {\n            sel = selectorArr[n];\n            if (!Util_1.Util.isValidSelector(sel)) {\n                Util_1.Util.warn('Selector \"' +\n                    sel +\n                    '\" is invalid. Allowed selectors examples are \"#foo\", \".bar\" or \"Group\".');\n                Util_1.Util.warn('If you have a custom shape with such className, please change it to start with upper letter like \"Triangle\".');\n                Util_1.Util.warn('Konva is awesome, right?');\n            }\n            if (sel.charAt(0) === '#') {\n                if (this.id() === sel.slice(1)) {\n                    return true;\n                }\n            }\n            else if (sel.charAt(0) === '.') {\n                if (this.hasName(sel.slice(1))) {\n                    return true;\n                }\n            }\n            else if (this.className === sel || this.nodeType === sel) {\n                return true;\n            }\n        }\n        return false;\n    }\n    getLayer() {\n        var parent = this.getParent();\n        return parent ? parent.getLayer() : null;\n    }\n    getStage() {\n        return this._getCache(STAGE, this._getStage);\n    }\n    _getStage() {\n        var parent = this.getParent();\n        if (parent) {\n            return parent.getStage();\n        }\n        else {\n            return null;\n        }\n    }\n    fire(eventType, evt = {}, bubble) {\n        evt.target = evt.target || this;\n        if (bubble) {\n            this._fireAndBubble(eventType, evt);\n        }\n        else {\n            this._fire(eventType, evt);\n        }\n        return this;\n    }\n    getAbsoluteTransform(top) {\n        if (top) {\n            return this._getAbsoluteTransform(top);\n        }\n        else {\n            return this._getCache(ABSOLUTE_TRANSFORM, this._getAbsoluteTransform);\n        }\n    }\n    _getAbsoluteTransform(top) {\n        var at;\n        if (top) {\n            at = new Util_1.Transform();\n            this._eachAncestorReverse(function (node) {\n                var transformsEnabled = node.transformsEnabled();\n                if (transformsEnabled === 'all') {\n                    at.multiply(node.getTransform());\n                }\n                else if (transformsEnabled === 'position') {\n                    at.translate(node.x() - node.offsetX(), node.y() - node.offsetY());\n                }\n            }, top);\n            return at;\n        }\n        else {\n            at = this._cache.get(ABSOLUTE_TRANSFORM) || new Util_1.Transform();\n            if (this.parent) {\n                this.parent.getAbsoluteTransform().copyInto(at);\n            }\n            else {\n                at.reset();\n            }\n            var transformsEnabled = this.transformsEnabled();\n            if (transformsEnabled === 'all') {\n                at.multiply(this.getTransform());\n            }\n            else if (transformsEnabled === 'position') {\n                const x = this.attrs.x || 0;\n                const y = this.attrs.y || 0;\n                const offsetX = this.attrs.offsetX || 0;\n                const offsetY = this.attrs.offsetY || 0;\n                at.translate(x - offsetX, y - offsetY);\n            }\n            at.dirty = false;\n            return at;\n        }\n    }\n    getAbsoluteScale(top) {\n        var parent = this;\n        while (parent) {\n            if (parent._isUnderCache) {\n                top = parent;\n            }\n            parent = parent.getParent();\n        }\n        const transform = this.getAbsoluteTransform(top);\n        const attrs = transform.decompose();\n        return {\n            x: attrs.scaleX,\n            y: attrs.scaleY,\n        };\n    }\n    getAbsoluteRotation() {\n        return this.getAbsoluteTransform().decompose().rotation;\n    }\n    getTransform() {\n        return this._getCache(TRANSFORM, this._getTransform);\n    }\n    _getTransform() {\n        var _a, _b;\n        var m = this._cache.get(TRANSFORM) || new Util_1.Transform();\n        m.reset();\n        var x = this.x(), y = this.y(), rotation = Global_1.Konva.getAngle(this.rotation()), scaleX = (_a = this.attrs.scaleX) !== null && _a !== void 0 ? _a : 1, scaleY = (_b = this.attrs.scaleY) !== null && _b !== void 0 ? _b : 1, skewX = this.attrs.skewX || 0, skewY = this.attrs.skewY || 0, offsetX = this.attrs.offsetX || 0, offsetY = this.attrs.offsetY || 0;\n        if (x !== 0 || y !== 0) {\n            m.translate(x, y);\n        }\n        if (rotation !== 0) {\n            m.rotate(rotation);\n        }\n        if (skewX !== 0 || skewY !== 0) {\n            m.skew(skewX, skewY);\n        }\n        if (scaleX !== 1 || scaleY !== 1) {\n            m.scale(scaleX, scaleY);\n        }\n        if (offsetX !== 0 || offsetY !== 0) {\n            m.translate(-1 * offsetX, -1 * offsetY);\n        }\n        m.dirty = false;\n        return m;\n    }\n    clone(obj) {\n        var attrs = Util_1.Util.cloneObject(this.attrs), key, allListeners, len, n, listener;\n        for (key in obj) {\n            attrs[key] = obj[key];\n        }\n        var node = new this.constructor(attrs);\n        for (key in this.eventListeners) {\n            allListeners = this.eventListeners[key];\n            len = allListeners.length;\n            for (n = 0; n < len; n++) {\n                listener = allListeners[n];\n                if (listener.name.indexOf(KONVA) < 0) {\n                    if (!node.eventListeners[key]) {\n                        node.eventListeners[key] = [];\n                    }\n                    node.eventListeners[key].push(listener);\n                }\n            }\n        }\n        return node;\n    }\n    _toKonvaCanvas(config) {\n        config = config || {};\n        var box = this.getClientRect();\n        var stage = this.getStage(), x = config.x !== undefined ? config.x : Math.floor(box.x), y = config.y !== undefined ? config.y : Math.floor(box.y), pixelRatio = config.pixelRatio || 1, canvas = new Canvas_1.SceneCanvas({\n            width: config.width || Math.ceil(box.width) || (stage ? stage.width() : 0),\n            height: config.height ||\n                Math.ceil(box.height) ||\n                (stage ? stage.height() : 0),\n            pixelRatio: pixelRatio,\n        }), context = canvas.getContext();\n        const bufferCanvas = new Canvas_1.SceneCanvas({\n            width: canvas.width / canvas.pixelRatio + Math.abs(x),\n            height: canvas.height / canvas.pixelRatio + Math.abs(y),\n            pixelRatio: canvas.pixelRatio,\n        });\n        if (config.imageSmoothingEnabled === false) {\n            context._context.imageSmoothingEnabled = false;\n        }\n        context.save();\n        if (x || y) {\n            context.translate(-1 * x, -1 * y);\n        }\n        this.drawScene(canvas, undefined, bufferCanvas);\n        context.restore();\n        return canvas;\n    }\n    toCanvas(config) {\n        return this._toKonvaCanvas(config)._canvas;\n    }\n    toDataURL(config) {\n        config = config || {};\n        var mimeType = config.mimeType || null, quality = config.quality || null;\n        var url = this._toKonvaCanvas(config).toDataURL(mimeType, quality);\n        if (config.callback) {\n            config.callback(url);\n        }\n        return url;\n    }\n    toImage(config) {\n        return new Promise((resolve, reject) => {\n            try {\n                const callback = config === null || config === void 0 ? void 0 : config.callback;\n                if (callback)\n                    delete config.callback;\n                Util_1.Util._urlToImage(this.toDataURL(config), function (img) {\n                    resolve(img);\n                    callback === null || callback === void 0 ? void 0 : callback(img);\n                });\n            }\n            catch (err) {\n                reject(err);\n            }\n        });\n    }\n    toBlob(config) {\n        return new Promise((resolve, reject) => {\n            try {\n                const callback = config === null || config === void 0 ? void 0 : config.callback;\n                if (callback)\n                    delete config.callback;\n                this.toCanvas(config).toBlob((blob) => {\n                    resolve(blob);\n                    callback === null || callback === void 0 ? void 0 : callback(blob);\n                }, config === null || config === void 0 ? void 0 : config.mimeType, config === null || config === void 0 ? void 0 : config.quality);\n            }\n            catch (err) {\n                reject(err);\n            }\n        });\n    }\n    setSize(size) {\n        this.width(size.width);\n        this.height(size.height);\n        return this;\n    }\n    getSize() {\n        return {\n            width: this.width(),\n            height: this.height(),\n        };\n    }\n    getClassName() {\n        return this.className || this.nodeType;\n    }\n    getType() {\n        return this.nodeType;\n    }\n    getDragDistance() {\n        if (this.attrs.dragDistance !== undefined) {\n            return this.attrs.dragDistance;\n        }\n        else if (this.parent) {\n            return this.parent.getDragDistance();\n        }\n        else {\n            return Global_1.Konva.dragDistance;\n        }\n    }\n    _off(type, name, callback) {\n        var evtListeners = this.eventListeners[type], i, evtName, handler;\n        for (i = 0; i < evtListeners.length; i++) {\n            evtName = evtListeners[i].name;\n            handler = evtListeners[i].handler;\n            if ((evtName !== 'konva' || name === 'konva') &&\n                (!name || evtName === name) &&\n                (!callback || callback === handler)) {\n                evtListeners.splice(i, 1);\n                if (evtListeners.length === 0) {\n                    delete this.eventListeners[type];\n                    break;\n                }\n                i--;\n            }\n        }\n    }\n    _fireChangeEvent(attr, oldVal, newVal) {\n        this._fire(attr + CHANGE, {\n            oldVal: oldVal,\n            newVal: newVal,\n        });\n    }\n    addName(name) {\n        if (!this.hasName(name)) {\n            var oldName = this.name();\n            var newName = oldName ? oldName + ' ' + name : name;\n            this.name(newName);\n        }\n        return this;\n    }\n    hasName(name) {\n        if (!name) {\n            return false;\n        }\n        const fullName = this.name();\n        if (!fullName) {\n            return false;\n        }\n        var names = (fullName || '').split(/\\s/g);\n        return names.indexOf(name) !== -1;\n    }\n    removeName(name) {\n        var names = (this.name() || '').split(/\\s/g);\n        var index = names.indexOf(name);\n        if (index !== -1) {\n            names.splice(index, 1);\n            this.name(names.join(' '));\n        }\n        return this;\n    }\n    setAttr(attr, val) {\n        var func = this[SET + Util_1.Util._capitalize(attr)];\n        if (Util_1.Util._isFunction(func)) {\n            func.call(this, val);\n        }\n        else {\n            this._setAttr(attr, val);\n        }\n        return this;\n    }\n    _requestDraw() {\n        if (Global_1.Konva.autoDrawEnabled) {\n            const drawNode = this.getLayer() || this.getStage();\n            drawNode === null || drawNode === void 0 ? void 0 : drawNode.batchDraw();\n        }\n    }\n    _setAttr(key, val) {\n        var oldVal = this.attrs[key];\n        if (oldVal === val && !Util_1.Util.isObject(val)) {\n            return;\n        }\n        if (val === undefined || val === null) {\n            delete this.attrs[key];\n        }\n        else {\n            this.attrs[key] = val;\n        }\n        if (this._shouldFireChangeEvents) {\n            this._fireChangeEvent(key, oldVal, val);\n        }\n        this._requestDraw();\n    }\n    _setComponentAttr(key, component, val) {\n        var oldVal;\n        if (val !== undefined) {\n            oldVal = this.attrs[key];\n            if (!oldVal) {\n                this.attrs[key] = this.getAttr(key);\n            }\n            this.attrs[key][component] = val;\n            this._fireChangeEvent(key, oldVal, val);\n        }\n    }\n    _fireAndBubble(eventType, evt, compareShape) {\n        if (evt && this.nodeType === SHAPE) {\n            evt.target = this;\n        }\n        var shouldStop = (eventType === MOUSEENTER || eventType === MOUSELEAVE) &&\n            ((compareShape &&\n                (this === compareShape ||\n                    (this.isAncestorOf && this.isAncestorOf(compareShape)))) ||\n                (this.nodeType === 'Stage' && !compareShape));\n        if (!shouldStop) {\n            this._fire(eventType, evt);\n            var stopBubble = (eventType === MOUSEENTER || eventType === MOUSELEAVE) &&\n                compareShape &&\n                compareShape.isAncestorOf &&\n                compareShape.isAncestorOf(this) &&\n                !compareShape.isAncestorOf(this.parent);\n            if (((evt && !evt.cancelBubble) || !evt) &&\n                this.parent &&\n                this.parent.isListening() &&\n                !stopBubble) {\n                if (compareShape && compareShape.parent) {\n                    this._fireAndBubble.call(this.parent, eventType, evt, compareShape);\n                }\n                else {\n                    this._fireAndBubble.call(this.parent, eventType, evt);\n                }\n            }\n        }\n    }\n    _getProtoListeners(eventType) {\n        var _a, _b, _c;\n        const allListeners = (_a = this._cache.get(ALL_LISTENERS)) !== null && _a !== void 0 ? _a : {};\n        let events = allListeners === null || allListeners === void 0 ? void 0 : allListeners[eventType];\n        if (events === undefined) {\n            events = [];\n            let obj = Object.getPrototypeOf(this);\n            while (obj) {\n                const hierarchyEvents = (_c = (_b = obj.eventListeners) === null || _b === void 0 ? void 0 : _b[eventType]) !== null && _c !== void 0 ? _c : [];\n                events.push(...hierarchyEvents);\n                obj = Object.getPrototypeOf(obj);\n            }\n            allListeners[eventType] = events;\n            this._cache.set(ALL_LISTENERS, allListeners);\n        }\n        return events;\n    }\n    _fire(eventType, evt) {\n        evt = evt || {};\n        evt.currentTarget = this;\n        evt.type = eventType;\n        const topListeners = this._getProtoListeners(eventType);\n        if (topListeners) {\n            for (var i = 0; i < topListeners.length; i++) {\n                topListeners[i].handler.call(this, evt);\n            }\n        }\n        const selfListeners = this.eventListeners[eventType];\n        if (selfListeners) {\n            for (var i = 0; i < selfListeners.length; i++) {\n                selfListeners[i].handler.call(this, evt);\n            }\n        }\n    }\n    draw() {\n        this.drawScene();\n        this.drawHit();\n        return this;\n    }\n    _createDragElement(evt) {\n        var pointerId = evt ? evt.pointerId : undefined;\n        var stage = this.getStage();\n        var ap = this.getAbsolutePosition();\n        if (!stage) {\n            return;\n        }\n        var pos = stage._getPointerById(pointerId) ||\n            stage._changedPointerPositions[0] ||\n            ap;\n        DragAndDrop_1.DD._dragElements.set(this._id, {\n            node: this,\n            startPointerPos: pos,\n            offset: {\n                x: pos.x - ap.x,\n                y: pos.y - ap.y,\n            },\n            dragStatus: 'ready',\n            pointerId,\n        });\n    }\n    startDrag(evt, bubbleEvent = true) {\n        if (!DragAndDrop_1.DD._dragElements.has(this._id)) {\n            this._createDragElement(evt);\n        }\n        const elem = DragAndDrop_1.DD._dragElements.get(this._id);\n        elem.dragStatus = 'dragging';\n        this.fire('dragstart', {\n            type: 'dragstart',\n            target: this,\n            evt: evt && evt.evt,\n        }, bubbleEvent);\n    }\n    _setDragPosition(evt, elem) {\n        const pos = this.getStage()._getPointerById(elem.pointerId);\n        if (!pos) {\n            return;\n        }\n        var newNodePos = {\n            x: pos.x - elem.offset.x,\n            y: pos.y - elem.offset.y,\n        };\n        var dbf = this.dragBoundFunc();\n        if (dbf !== undefined) {\n            const bounded = dbf.call(this, newNodePos, evt);\n            if (!bounded) {\n                Util_1.Util.warn('dragBoundFunc did not return any value. That is unexpected behavior. You must return new absolute position from dragBoundFunc.');\n            }\n            else {\n                newNodePos = bounded;\n            }\n        }\n        if (!this._lastPos ||\n            this._lastPos.x !== newNodePos.x ||\n            this._lastPos.y !== newNodePos.y) {\n            this.setAbsolutePosition(newNodePos);\n            this._requestDraw();\n        }\n        this._lastPos = newNodePos;\n    }\n    stopDrag(evt) {\n        const elem = DragAndDrop_1.DD._dragElements.get(this._id);\n        if (elem) {\n            elem.dragStatus = 'stopped';\n        }\n        DragAndDrop_1.DD._endDragBefore(evt);\n        DragAndDrop_1.DD._endDragAfter(evt);\n    }\n    setDraggable(draggable) {\n        this._setAttr('draggable', draggable);\n        this._dragChange();\n    }\n    isDragging() {\n        const elem = DragAndDrop_1.DD._dragElements.get(this._id);\n        return elem ? elem.dragStatus === 'dragging' : false;\n    }\n    _listenDrag() {\n        this._dragCleanup();\n        this.on('mousedown.konva touchstart.konva', function (evt) {\n            var shouldCheckButton = evt.evt['button'] !== undefined;\n            var canDrag = !shouldCheckButton || Global_1.Konva.dragButtons.indexOf(evt.evt['button']) >= 0;\n            if (!canDrag) {\n                return;\n            }\n            if (this.isDragging()) {\n                return;\n            }\n            var hasDraggingChild = false;\n            DragAndDrop_1.DD._dragElements.forEach((elem) => {\n                if (this.isAncestorOf(elem.node)) {\n                    hasDraggingChild = true;\n                }\n            });\n            if (!hasDraggingChild) {\n                this._createDragElement(evt);\n            }\n        });\n    }\n    _dragChange() {\n        if (this.attrs.draggable) {\n            this._listenDrag();\n        }\n        else {\n            this._dragCleanup();\n            var stage = this.getStage();\n            if (!stage) {\n                return;\n            }\n            const dragElement = DragAndDrop_1.DD._dragElements.get(this._id);\n            const isDragging = dragElement && dragElement.dragStatus === 'dragging';\n            const isReady = dragElement && dragElement.dragStatus === 'ready';\n            if (isDragging) {\n                this.stopDrag();\n            }\n            else if (isReady) {\n                DragAndDrop_1.DD._dragElements.delete(this._id);\n            }\n        }\n    }\n    _dragCleanup() {\n        this.off('mousedown.konva');\n        this.off('touchstart.konva');\n    }\n    isClientRectOnScreen(margin = { x: 0, y: 0 }) {\n        const stage = this.getStage();\n        if (!stage) {\n            return false;\n        }\n        const screenRect = {\n            x: -margin.x,\n            y: -margin.y,\n            width: stage.width() + 2 * margin.x,\n            height: stage.height() + 2 * margin.y,\n        };\n        return Util_1.Util.haveIntersection(screenRect, this.getClientRect());\n    }\n    static create(data, container) {\n        if (Util_1.Util._isString(data)) {\n            data = JSON.parse(data);\n        }\n        return this._createNode(data, container);\n    }\n    static _createNode(obj, container) {\n        var className = Node.prototype.getClassName.call(obj), children = obj.children, no, len, n;\n        if (container) {\n            obj.attrs.container = container;\n        }\n        if (!Global_1.Konva[className]) {\n            Util_1.Util.warn('Can not find a node with class name \"' +\n                className +\n                '\". Fallback to \"Shape\".');\n            className = 'Shape';\n        }\n        const Class = Global_1.Konva[className];\n        no = new Class(obj.attrs);\n        if (children) {\n            len = children.length;\n            for (n = 0; n < len; n++) {\n                no.add(Node._createNode(children[n]));\n            }\n        }\n        return no;\n    }\n}\nexports.Node = Node;\nNode.prototype.nodeType = 'Node';\nNode.prototype._attrsAffectingSize = [];\nNode.prototype.eventListeners = {};\nNode.prototype.on.call(Node.prototype, TRANSFORM_CHANGE_STR, function () {\n    if (this._batchingTransformChange) {\n        this._needClearTransformCache = true;\n        return;\n    }\n    this._clearCache(TRANSFORM);\n    this._clearSelfAndDescendantCache(ABSOLUTE_TRANSFORM);\n});\nNode.prototype.on.call(Node.prototype, 'visibleChange.konva', function () {\n    this._clearSelfAndDescendantCache(VISIBLE);\n});\nNode.prototype.on.call(Node.prototype, 'listeningChange.konva', function () {\n    this._clearSelfAndDescendantCache(LISTENING);\n});\nNode.prototype.on.call(Node.prototype, 'opacityChange.konva', function () {\n    this._clearSelfAndDescendantCache(ABSOLUTE_OPACITY);\n});\nconst addGetterSetter = Factory_1.Factory.addGetterSetter;\naddGetterSetter(Node, 'zIndex');\naddGetterSetter(Node, 'absolutePosition');\naddGetterSetter(Node, 'position');\naddGetterSetter(Node, 'x', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'y', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'globalCompositeOperation', 'source-over', (0, Validators_1.getStringValidator)());\naddGetterSetter(Node, 'opacity', 1, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'name', '', (0, Validators_1.getStringValidator)());\naddGetterSetter(Node, 'id', '', (0, Validators_1.getStringValidator)());\naddGetterSetter(Node, 'rotation', 0, (0, Validators_1.getNumberValidator)());\nFactory_1.Factory.addComponentsGetterSetter(Node, 'scale', ['x', 'y']);\naddGetterSetter(Node, 'scaleX', 1, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'scaleY', 1, (0, Validators_1.getNumberValidator)());\nFactory_1.Factory.addComponentsGetterSetter(Node, 'skew', ['x', 'y']);\naddGetterSetter(Node, 'skewX', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'skewY', 0, (0, Validators_1.getNumberValidator)());\nFactory_1.Factory.addComponentsGetterSetter(Node, 'offset', ['x', 'y']);\naddGetterSetter(Node, 'offsetX', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'offsetY', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'dragDistance', null, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'width', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'height', 0, (0, Validators_1.getNumberValidator)());\naddGetterSetter(Node, 'listening', true, (0, Validators_1.getBooleanValidator)());\naddGetterSetter(Node, 'preventDefault', true, (0, Validators_1.getBooleanValidator)());\naddGetterSetter(Node, 'filters', null, function (val) {\n    this._filterUpToDate = false;\n    return val;\n});\naddGetterSetter(Node, 'visible', true, (0, Validators_1.getBooleanValidator)());\naddGetterSetter(Node, 'transformsEnabled', 'all', (0, Validators_1.getStringValidator)());\naddGetterSetter(Node, 'size');\naddGetterSetter(Node, 'dragBoundFunc');\naddGetterSetter(Node, 'draggable', false, (0, Validators_1.getBooleanValidator)());\nFactory_1.Factory.backCompat(Node, {\n    rotateDeg: 'rotate',\n    setRotationDeg: 'setRotation',\n    getRotationDeg: 'getRotation',\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}