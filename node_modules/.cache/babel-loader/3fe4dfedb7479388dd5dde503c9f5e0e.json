{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Kaleidoscope = void 0;\n\nconst Factory_1 = require(\"../Factory\");\n\nconst Node_1 = require(\"../Node\");\n\nconst Util_1 = require(\"../Util\");\n\nconst Validators_1 = require(\"../Validators\");\n\nvar ToPolar = function (src, dst, opt) {\n  var srcPixels = src.data,\n      dstPixels = dst.data,\n      xSize = src.width,\n      ySize = src.height,\n      xMid = opt.polarCenterX || xSize / 2,\n      yMid = opt.polarCenterY || ySize / 2,\n      i,\n      x,\n      y,\n      r = 0,\n      g = 0,\n      b = 0,\n      a = 0;\n  var rad,\n      rMax = Math.sqrt(xMid * xMid + yMid * yMid);\n  x = xSize - xMid;\n  y = ySize - yMid;\n  rad = Math.sqrt(x * x + y * y);\n  rMax = rad > rMax ? rad : rMax;\n  var rSize = ySize,\n      tSize = xSize,\n      radius,\n      theta;\n  var conversion = 360 / tSize * Math.PI / 180,\n      sin,\n      cos;\n\n  for (theta = 0; theta < tSize; theta += 1) {\n    sin = Math.sin(theta * conversion);\n    cos = Math.cos(theta * conversion);\n\n    for (radius = 0; radius < rSize; radius += 1) {\n      x = Math.floor(xMid + rMax * radius / rSize * cos);\n      y = Math.floor(yMid + rMax * radius / rSize * sin);\n      i = (y * xSize + x) * 4;\n      r = srcPixels[i + 0];\n      g = srcPixels[i + 1];\n      b = srcPixels[i + 2];\n      a = srcPixels[i + 3];\n      i = (theta + radius * xSize) * 4;\n      dstPixels[i + 0] = r;\n      dstPixels[i + 1] = g;\n      dstPixels[i + 2] = b;\n      dstPixels[i + 3] = a;\n    }\n  }\n};\n\nvar FromPolar = function (src, dst, opt) {\n  var srcPixels = src.data,\n      dstPixels = dst.data,\n      xSize = src.width,\n      ySize = src.height,\n      xMid = opt.polarCenterX || xSize / 2,\n      yMid = opt.polarCenterY || ySize / 2,\n      i,\n      x,\n      y,\n      dx,\n      dy,\n      r = 0,\n      g = 0,\n      b = 0,\n      a = 0;\n  var rad,\n      rMax = Math.sqrt(xMid * xMid + yMid * yMid);\n  x = xSize - xMid;\n  y = ySize - yMid;\n  rad = Math.sqrt(x * x + y * y);\n  rMax = rad > rMax ? rad : rMax;\n  var rSize = ySize,\n      tSize = xSize,\n      radius,\n      theta,\n      phaseShift = opt.polarRotation || 0;\n  var x1, y1;\n\n  for (x = 0; x < xSize; x += 1) {\n    for (y = 0; y < ySize; y += 1) {\n      dx = x - xMid;\n      dy = y - yMid;\n      radius = Math.sqrt(dx * dx + dy * dy) * rSize / rMax;\n      theta = (Math.atan2(dy, dx) * 180 / Math.PI + 360 + phaseShift) % 360;\n      theta = theta * tSize / 360;\n      x1 = Math.floor(theta);\n      y1 = Math.floor(radius);\n      i = (y1 * xSize + x1) * 4;\n      r = srcPixels[i + 0];\n      g = srcPixels[i + 1];\n      b = srcPixels[i + 2];\n      a = srcPixels[i + 3];\n      i = (y * xSize + x) * 4;\n      dstPixels[i + 0] = r;\n      dstPixels[i + 1] = g;\n      dstPixels[i + 2] = b;\n      dstPixels[i + 3] = a;\n    }\n  }\n};\n\nconst Kaleidoscope = function (imageData) {\n  var xSize = imageData.width,\n      ySize = imageData.height;\n  var x, y, xoff, i, r, g, b, a, srcPos, dstPos;\n  var power = Math.round(this.kaleidoscopePower());\n  var angle = Math.round(this.kaleidoscopeAngle());\n  var offset = Math.floor(xSize * (angle % 360) / 360);\n\n  if (power < 1) {\n    return;\n  }\n\n  var tempCanvas = Util_1.Util.createCanvasElement();\n  tempCanvas.width = xSize;\n  tempCanvas.height = ySize;\n  var scratchData = tempCanvas.getContext('2d').getImageData(0, 0, xSize, ySize);\n  Util_1.Util.releaseCanvas(tempCanvas);\n  ToPolar(imageData, scratchData, {\n    polarCenterX: xSize / 2,\n    polarCenterY: ySize / 2\n  });\n  var minSectionSize = xSize / Math.pow(2, power);\n\n  while (minSectionSize <= 8) {\n    minSectionSize = minSectionSize * 2;\n    power -= 1;\n  }\n\n  minSectionSize = Math.ceil(minSectionSize);\n  var sectionSize = minSectionSize;\n  var xStart = 0,\n      xEnd = sectionSize,\n      xDelta = 1;\n\n  if (offset + minSectionSize > xSize) {\n    xStart = sectionSize;\n    xEnd = 0;\n    xDelta = -1;\n  }\n\n  for (y = 0; y < ySize; y += 1) {\n    for (x = xStart; x !== xEnd; x += xDelta) {\n      xoff = Math.round(x + offset) % xSize;\n      srcPos = (xSize * y + xoff) * 4;\n      r = scratchData.data[srcPos + 0];\n      g = scratchData.data[srcPos + 1];\n      b = scratchData.data[srcPos + 2];\n      a = scratchData.data[srcPos + 3];\n      dstPos = (xSize * y + x) * 4;\n      scratchData.data[dstPos + 0] = r;\n      scratchData.data[dstPos + 1] = g;\n      scratchData.data[dstPos + 2] = b;\n      scratchData.data[dstPos + 3] = a;\n    }\n  }\n\n  for (y = 0; y < ySize; y += 1) {\n    sectionSize = Math.floor(minSectionSize);\n\n    for (i = 0; i < power; i += 1) {\n      for (x = 0; x < sectionSize + 1; x += 1) {\n        srcPos = (xSize * y + x) * 4;\n        r = scratchData.data[srcPos + 0];\n        g = scratchData.data[srcPos + 1];\n        b = scratchData.data[srcPos + 2];\n        a = scratchData.data[srcPos + 3];\n        dstPos = (xSize * y + sectionSize * 2 - x - 1) * 4;\n        scratchData.data[dstPos + 0] = r;\n        scratchData.data[dstPos + 1] = g;\n        scratchData.data[dstPos + 2] = b;\n        scratchData.data[dstPos + 3] = a;\n      }\n\n      sectionSize *= 2;\n    }\n  }\n\n  FromPolar(scratchData, imageData, {\n    polarRotation: 0\n  });\n};\n\nexports.Kaleidoscope = Kaleidoscope;\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'kaleidoscopePower', 2, (0, Validators_1.getNumberValidator)(), Factory_1.Factory.afterSetFilter);\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'kaleidoscopeAngle', 0, (0, Validators_1.getNumberValidator)(), Factory_1.Factory.afterSetFilter);","map":{"version":3,"names":["Object","defineProperty","exports","value","Kaleidoscope","Factory_1","require","Node_1","Util_1","Validators_1","ToPolar","src","dst","opt","srcPixels","data","dstPixels","xSize","width","ySize","height","xMid","polarCenterX","yMid","polarCenterY","i","x","y","r","g","b","a","rad","rMax","Math","sqrt","rSize","tSize","radius","theta","conversion","PI","sin","cos","floor","FromPolar","dx","dy","phaseShift","polarRotation","x1","y1","atan2","imageData","xoff","srcPos","dstPos","power","round","kaleidoscopePower","angle","kaleidoscopeAngle","offset","tempCanvas","Util","createCanvasElement","scratchData","getContext","getImageData","releaseCanvas","minSectionSize","pow","ceil","sectionSize","xStart","xEnd","xDelta","Factory","addGetterSetter","Node","getNumberValidator","afterSetFilter"],"sources":["D:/screenshort-extension/image-editor-react/node_modules/konva/lib/filters/Kaleidoscope.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Kaleidoscope = void 0;\nconst Factory_1 = require(\"../Factory\");\nconst Node_1 = require(\"../Node\");\nconst Util_1 = require(\"../Util\");\nconst Validators_1 = require(\"../Validators\");\nvar ToPolar = function (src, dst, opt) {\n    var srcPixels = src.data, dstPixels = dst.data, xSize = src.width, ySize = src.height, xMid = opt.polarCenterX || xSize / 2, yMid = opt.polarCenterY || ySize / 2, i, x, y, r = 0, g = 0, b = 0, a = 0;\n    var rad, rMax = Math.sqrt(xMid * xMid + yMid * yMid);\n    x = xSize - xMid;\n    y = ySize - yMid;\n    rad = Math.sqrt(x * x + y * y);\n    rMax = rad > rMax ? rad : rMax;\n    var rSize = ySize, tSize = xSize, radius, theta;\n    var conversion = ((360 / tSize) * Math.PI) / 180, sin, cos;\n    for (theta = 0; theta < tSize; theta += 1) {\n        sin = Math.sin(theta * conversion);\n        cos = Math.cos(theta * conversion);\n        for (radius = 0; radius < rSize; radius += 1) {\n            x = Math.floor(xMid + ((rMax * radius) / rSize) * cos);\n            y = Math.floor(yMid + ((rMax * radius) / rSize) * sin);\n            i = (y * xSize + x) * 4;\n            r = srcPixels[i + 0];\n            g = srcPixels[i + 1];\n            b = srcPixels[i + 2];\n            a = srcPixels[i + 3];\n            i = (theta + radius * xSize) * 4;\n            dstPixels[i + 0] = r;\n            dstPixels[i + 1] = g;\n            dstPixels[i + 2] = b;\n            dstPixels[i + 3] = a;\n        }\n    }\n};\nvar FromPolar = function (src, dst, opt) {\n    var srcPixels = src.data, dstPixels = dst.data, xSize = src.width, ySize = src.height, xMid = opt.polarCenterX || xSize / 2, yMid = opt.polarCenterY || ySize / 2, i, x, y, dx, dy, r = 0, g = 0, b = 0, a = 0;\n    var rad, rMax = Math.sqrt(xMid * xMid + yMid * yMid);\n    x = xSize - xMid;\n    y = ySize - yMid;\n    rad = Math.sqrt(x * x + y * y);\n    rMax = rad > rMax ? rad : rMax;\n    var rSize = ySize, tSize = xSize, radius, theta, phaseShift = opt.polarRotation || 0;\n    var x1, y1;\n    for (x = 0; x < xSize; x += 1) {\n        for (y = 0; y < ySize; y += 1) {\n            dx = x - xMid;\n            dy = y - yMid;\n            radius = (Math.sqrt(dx * dx + dy * dy) * rSize) / rMax;\n            theta = ((Math.atan2(dy, dx) * 180) / Math.PI + 360 + phaseShift) % 360;\n            theta = (theta * tSize) / 360;\n            x1 = Math.floor(theta);\n            y1 = Math.floor(radius);\n            i = (y1 * xSize + x1) * 4;\n            r = srcPixels[i + 0];\n            g = srcPixels[i + 1];\n            b = srcPixels[i + 2];\n            a = srcPixels[i + 3];\n            i = (y * xSize + x) * 4;\n            dstPixels[i + 0] = r;\n            dstPixels[i + 1] = g;\n            dstPixels[i + 2] = b;\n            dstPixels[i + 3] = a;\n        }\n    }\n};\nconst Kaleidoscope = function (imageData) {\n    var xSize = imageData.width, ySize = imageData.height;\n    var x, y, xoff, i, r, g, b, a, srcPos, dstPos;\n    var power = Math.round(this.kaleidoscopePower());\n    var angle = Math.round(this.kaleidoscopeAngle());\n    var offset = Math.floor((xSize * (angle % 360)) / 360);\n    if (power < 1) {\n        return;\n    }\n    var tempCanvas = Util_1.Util.createCanvasElement();\n    tempCanvas.width = xSize;\n    tempCanvas.height = ySize;\n    var scratchData = tempCanvas\n        .getContext('2d')\n        .getImageData(0, 0, xSize, ySize);\n    Util_1.Util.releaseCanvas(tempCanvas);\n    ToPolar(imageData, scratchData, {\n        polarCenterX: xSize / 2,\n        polarCenterY: ySize / 2,\n    });\n    var minSectionSize = xSize / Math.pow(2, power);\n    while (minSectionSize <= 8) {\n        minSectionSize = minSectionSize * 2;\n        power -= 1;\n    }\n    minSectionSize = Math.ceil(minSectionSize);\n    var sectionSize = minSectionSize;\n    var xStart = 0, xEnd = sectionSize, xDelta = 1;\n    if (offset + minSectionSize > xSize) {\n        xStart = sectionSize;\n        xEnd = 0;\n        xDelta = -1;\n    }\n    for (y = 0; y < ySize; y += 1) {\n        for (x = xStart; x !== xEnd; x += xDelta) {\n            xoff = Math.round(x + offset) % xSize;\n            srcPos = (xSize * y + xoff) * 4;\n            r = scratchData.data[srcPos + 0];\n            g = scratchData.data[srcPos + 1];\n            b = scratchData.data[srcPos + 2];\n            a = scratchData.data[srcPos + 3];\n            dstPos = (xSize * y + x) * 4;\n            scratchData.data[dstPos + 0] = r;\n            scratchData.data[dstPos + 1] = g;\n            scratchData.data[dstPos + 2] = b;\n            scratchData.data[dstPos + 3] = a;\n        }\n    }\n    for (y = 0; y < ySize; y += 1) {\n        sectionSize = Math.floor(minSectionSize);\n        for (i = 0; i < power; i += 1) {\n            for (x = 0; x < sectionSize + 1; x += 1) {\n                srcPos = (xSize * y + x) * 4;\n                r = scratchData.data[srcPos + 0];\n                g = scratchData.data[srcPos + 1];\n                b = scratchData.data[srcPos + 2];\n                a = scratchData.data[srcPos + 3];\n                dstPos = (xSize * y + sectionSize * 2 - x - 1) * 4;\n                scratchData.data[dstPos + 0] = r;\n                scratchData.data[dstPos + 1] = g;\n                scratchData.data[dstPos + 2] = b;\n                scratchData.data[dstPos + 3] = a;\n            }\n            sectionSize *= 2;\n        }\n    }\n    FromPolar(scratchData, imageData, { polarRotation: 0 });\n};\nexports.Kaleidoscope = Kaleidoscope;\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'kaleidoscopePower', 2, (0, Validators_1.getNumberValidator)(), Factory_1.Factory.afterSetFilter);\nFactory_1.Factory.addGetterSetter(Node_1.Node, 'kaleidoscopeAngle', 0, (0, Validators_1.getNumberValidator)(), Factory_1.Factory.afterSetFilter);\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}