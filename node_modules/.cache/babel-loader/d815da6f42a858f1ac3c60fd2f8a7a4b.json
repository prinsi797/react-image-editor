{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Sprite = void 0;\n\nconst Factory_1 = require(\"../Factory\");\n\nconst Shape_1 = require(\"../Shape\");\n\nconst Animation_1 = require(\"../Animation\");\n\nconst Validators_1 = require(\"../Validators\");\n\nconst Global_1 = require(\"../Global\");\n\nclass Sprite extends Shape_1.Shape {\n  constructor(config) {\n    super(config);\n    this._updated = true;\n    this.anim = new Animation_1.Animation(() => {\n      var updated = this._updated;\n      this._updated = false;\n      return updated;\n    });\n    this.on('animationChange.konva', function () {\n      this.frameIndex(0);\n    });\n    this.on('frameIndexChange.konva', function () {\n      this._updated = true;\n    });\n    this.on('frameRateChange.konva', function () {\n      if (!this.anim.isRunning()) {\n        return;\n      }\n\n      clearInterval(this.interval);\n\n      this._setInterval();\n    });\n  }\n\n  _sceneFunc(context) {\n    var anim = this.animation(),\n        index = this.frameIndex(),\n        ix4 = index * 4,\n        set = this.animations()[anim],\n        offsets = this.frameOffsets(),\n        x = set[ix4 + 0],\n        y = set[ix4 + 1],\n        width = set[ix4 + 2],\n        height = set[ix4 + 3],\n        image = this.image();\n\n    if (this.hasFill() || this.hasStroke()) {\n      context.beginPath();\n      context.rect(0, 0, width, height);\n      context.closePath();\n      context.fillStrokeShape(this);\n    }\n\n    if (image) {\n      if (offsets) {\n        var offset = offsets[anim],\n            ix2 = index * 2;\n        context.drawImage(image, x, y, width, height, offset[ix2 + 0], offset[ix2 + 1], width, height);\n      } else {\n        context.drawImage(image, x, y, width, height, 0, 0, width, height);\n      }\n    }\n  }\n\n  _hitFunc(context) {\n    var anim = this.animation(),\n        index = this.frameIndex(),\n        ix4 = index * 4,\n        set = this.animations()[anim],\n        offsets = this.frameOffsets(),\n        width = set[ix4 + 2],\n        height = set[ix4 + 3];\n    context.beginPath();\n\n    if (offsets) {\n      var offset = offsets[anim];\n      var ix2 = index * 2;\n      context.rect(offset[ix2 + 0], offset[ix2 + 1], width, height);\n    } else {\n      context.rect(0, 0, width, height);\n    }\n\n    context.closePath();\n    context.fillShape(this);\n  }\n\n  _useBufferCanvas() {\n    return super._useBufferCanvas(true);\n  }\n\n  _setInterval() {\n    var that = this;\n    this.interval = setInterval(function () {\n      that._updateIndex();\n    }, 1000 / this.frameRate());\n  }\n\n  start() {\n    if (this.isRunning()) {\n      return;\n    }\n\n    var layer = this.getLayer();\n    this.anim.setLayers(layer);\n\n    this._setInterval();\n\n    this.anim.start();\n  }\n\n  stop() {\n    this.anim.stop();\n    clearInterval(this.interval);\n  }\n\n  isRunning() {\n    return this.anim.isRunning();\n  }\n\n  _updateIndex() {\n    var index = this.frameIndex(),\n        animation = this.animation(),\n        animations = this.animations(),\n        anim = animations[animation],\n        len = anim.length / 4;\n\n    if (index < len - 1) {\n      this.frameIndex(index + 1);\n    } else {\n      this.frameIndex(0);\n    }\n  }\n\n}\n\nexports.Sprite = Sprite;\nSprite.prototype.className = 'Sprite';\n(0, Global_1._registerNode)(Sprite);\nFactory_1.Factory.addGetterSetter(Sprite, 'animation');\nFactory_1.Factory.addGetterSetter(Sprite, 'animations');\nFactory_1.Factory.addGetterSetter(Sprite, 'frameOffsets');\nFactory_1.Factory.addGetterSetter(Sprite, 'image');\nFactory_1.Factory.addGetterSetter(Sprite, 'frameIndex', 0, (0, Validators_1.getNumberValidator)());\nFactory_1.Factory.addGetterSetter(Sprite, 'frameRate', 17, (0, Validators_1.getNumberValidator)());\nFactory_1.Factory.backCompat(Sprite, {\n  index: 'frameIndex',\n  getIndex: 'getFrameIndex',\n  setIndex: 'setFrameIndex'\n});","map":{"version":3,"names":["Object","defineProperty","exports","value","Sprite","Factory_1","require","Shape_1","Animation_1","Validators_1","Global_1","Shape","constructor","config","_updated","anim","Animation","updated","on","frameIndex","isRunning","clearInterval","interval","_setInterval","_sceneFunc","context","animation","index","ix4","set","animations","offsets","frameOffsets","x","y","width","height","image","hasFill","hasStroke","beginPath","rect","closePath","fillStrokeShape","offset","ix2","drawImage","_hitFunc","fillShape","_useBufferCanvas","that","setInterval","_updateIndex","frameRate","start","layer","getLayer","setLayers","stop","len","length","prototype","className","_registerNode","Factory","addGetterSetter","getNumberValidator","backCompat","getIndex","setIndex"],"sources":["D:/screenshort-extension/image-editor-react/node_modules/konva/lib/shapes/Sprite.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Sprite = void 0;\nconst Factory_1 = require(\"../Factory\");\nconst Shape_1 = require(\"../Shape\");\nconst Animation_1 = require(\"../Animation\");\nconst Validators_1 = require(\"../Validators\");\nconst Global_1 = require(\"../Global\");\nclass Sprite extends Shape_1.Shape {\n    constructor(config) {\n        super(config);\n        this._updated = true;\n        this.anim = new Animation_1.Animation(() => {\n            var updated = this._updated;\n            this._updated = false;\n            return updated;\n        });\n        this.on('animationChange.konva', function () {\n            this.frameIndex(0);\n        });\n        this.on('frameIndexChange.konva', function () {\n            this._updated = true;\n        });\n        this.on('frameRateChange.konva', function () {\n            if (!this.anim.isRunning()) {\n                return;\n            }\n            clearInterval(this.interval);\n            this._setInterval();\n        });\n    }\n    _sceneFunc(context) {\n        var anim = this.animation(), index = this.frameIndex(), ix4 = index * 4, set = this.animations()[anim], offsets = this.frameOffsets(), x = set[ix4 + 0], y = set[ix4 + 1], width = set[ix4 + 2], height = set[ix4 + 3], image = this.image();\n        if (this.hasFill() || this.hasStroke()) {\n            context.beginPath();\n            context.rect(0, 0, width, height);\n            context.closePath();\n            context.fillStrokeShape(this);\n        }\n        if (image) {\n            if (offsets) {\n                var offset = offsets[anim], ix2 = index * 2;\n                context.drawImage(image, x, y, width, height, offset[ix2 + 0], offset[ix2 + 1], width, height);\n            }\n            else {\n                context.drawImage(image, x, y, width, height, 0, 0, width, height);\n            }\n        }\n    }\n    _hitFunc(context) {\n        var anim = this.animation(), index = this.frameIndex(), ix4 = index * 4, set = this.animations()[anim], offsets = this.frameOffsets(), width = set[ix4 + 2], height = set[ix4 + 3];\n        context.beginPath();\n        if (offsets) {\n            var offset = offsets[anim];\n            var ix2 = index * 2;\n            context.rect(offset[ix2 + 0], offset[ix2 + 1], width, height);\n        }\n        else {\n            context.rect(0, 0, width, height);\n        }\n        context.closePath();\n        context.fillShape(this);\n    }\n    _useBufferCanvas() {\n        return super._useBufferCanvas(true);\n    }\n    _setInterval() {\n        var that = this;\n        this.interval = setInterval(function () {\n            that._updateIndex();\n        }, 1000 / this.frameRate());\n    }\n    start() {\n        if (this.isRunning()) {\n            return;\n        }\n        var layer = this.getLayer();\n        this.anim.setLayers(layer);\n        this._setInterval();\n        this.anim.start();\n    }\n    stop() {\n        this.anim.stop();\n        clearInterval(this.interval);\n    }\n    isRunning() {\n        return this.anim.isRunning();\n    }\n    _updateIndex() {\n        var index = this.frameIndex(), animation = this.animation(), animations = this.animations(), anim = animations[animation], len = anim.length / 4;\n        if (index < len - 1) {\n            this.frameIndex(index + 1);\n        }\n        else {\n            this.frameIndex(0);\n        }\n    }\n}\nexports.Sprite = Sprite;\nSprite.prototype.className = 'Sprite';\n(0, Global_1._registerNode)(Sprite);\nFactory_1.Factory.addGetterSetter(Sprite, 'animation');\nFactory_1.Factory.addGetterSetter(Sprite, 'animations');\nFactory_1.Factory.addGetterSetter(Sprite, 'frameOffsets');\nFactory_1.Factory.addGetterSetter(Sprite, 'image');\nFactory_1.Factory.addGetterSetter(Sprite, 'frameIndex', 0, (0, Validators_1.getNumberValidator)());\nFactory_1.Factory.addGetterSetter(Sprite, 'frameRate', 17, (0, Validators_1.getNumberValidator)());\nFactory_1.Factory.backCompat(Sprite, {\n    index: 'frameIndex',\n    getIndex: 'getFrameIndex',\n    setIndex: 'setFrameIndex',\n});\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}