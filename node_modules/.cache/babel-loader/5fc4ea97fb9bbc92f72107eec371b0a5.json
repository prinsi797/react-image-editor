{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Stage = exports.stages = void 0;\n\nconst Util_1 = require(\"./Util\");\n\nconst Factory_1 = require(\"./Factory\");\n\nconst Container_1 = require(\"./Container\");\n\nconst Global_1 = require(\"./Global\");\n\nconst Canvas_1 = require(\"./Canvas\");\n\nconst DragAndDrop_1 = require(\"./DragAndDrop\");\n\nconst Global_2 = require(\"./Global\");\n\nconst PointerEvents = require(\"./PointerEvents\");\n\nvar STAGE = 'Stage',\n    STRING = 'string',\n    PX = 'px',\n    MOUSEOUT = 'mouseout',\n    MOUSELEAVE = 'mouseleave',\n    MOUSEOVER = 'mouseover',\n    MOUSEENTER = 'mouseenter',\n    MOUSEMOVE = 'mousemove',\n    MOUSEDOWN = 'mousedown',\n    MOUSEUP = 'mouseup',\n    POINTERMOVE = 'pointermove',\n    POINTERDOWN = 'pointerdown',\n    POINTERUP = 'pointerup',\n    POINTERCANCEL = 'pointercancel',\n    LOSTPOINTERCAPTURE = 'lostpointercapture',\n    POINTEROUT = 'pointerout',\n    POINTERLEAVE = 'pointerleave',\n    POINTEROVER = 'pointerover',\n    POINTERENTER = 'pointerenter',\n    CONTEXTMENU = 'contextmenu',\n    TOUCHSTART = 'touchstart',\n    TOUCHEND = 'touchend',\n    TOUCHMOVE = 'touchmove',\n    TOUCHCANCEL = 'touchcancel',\n    WHEEL = 'wheel',\n    MAX_LAYERS_NUMBER = 5,\n    EVENTS = [[MOUSEENTER, '_pointerenter'], [MOUSEDOWN, '_pointerdown'], [MOUSEMOVE, '_pointermove'], [MOUSEUP, '_pointerup'], [MOUSELEAVE, '_pointerleave'], [TOUCHSTART, '_pointerdown'], [TOUCHMOVE, '_pointermove'], [TOUCHEND, '_pointerup'], [TOUCHCANCEL, '_pointercancel'], [MOUSEOVER, '_pointerover'], [WHEEL, '_wheel'], [CONTEXTMENU, '_contextmenu'], [POINTERDOWN, '_pointerdown'], [POINTERMOVE, '_pointermove'], [POINTERUP, '_pointerup'], [POINTERCANCEL, '_pointercancel'], [LOSTPOINTERCAPTURE, '_lostpointercapture']];\nconst EVENTS_MAP = {\n  mouse: {\n    [POINTEROUT]: MOUSEOUT,\n    [POINTERLEAVE]: MOUSELEAVE,\n    [POINTEROVER]: MOUSEOVER,\n    [POINTERENTER]: MOUSEENTER,\n    [POINTERMOVE]: MOUSEMOVE,\n    [POINTERDOWN]: MOUSEDOWN,\n    [POINTERUP]: MOUSEUP,\n    [POINTERCANCEL]: 'mousecancel',\n    pointerclick: 'click',\n    pointerdblclick: 'dblclick'\n  },\n  touch: {\n    [POINTEROUT]: 'touchout',\n    [POINTERLEAVE]: 'touchleave',\n    [POINTEROVER]: 'touchover',\n    [POINTERENTER]: 'touchenter',\n    [POINTERMOVE]: TOUCHMOVE,\n    [POINTERDOWN]: TOUCHSTART,\n    [POINTERUP]: TOUCHEND,\n    [POINTERCANCEL]: TOUCHCANCEL,\n    pointerclick: 'tap',\n    pointerdblclick: 'dbltap'\n  },\n  pointer: {\n    [POINTEROUT]: POINTEROUT,\n    [POINTERLEAVE]: POINTERLEAVE,\n    [POINTEROVER]: POINTEROVER,\n    [POINTERENTER]: POINTERENTER,\n    [POINTERMOVE]: POINTERMOVE,\n    [POINTERDOWN]: POINTERDOWN,\n    [POINTERUP]: POINTERUP,\n    [POINTERCANCEL]: POINTERCANCEL,\n    pointerclick: 'pointerclick',\n    pointerdblclick: 'pointerdblclick'\n  }\n};\n\nconst getEventType = type => {\n  if (type.indexOf('pointer') >= 0) {\n    return 'pointer';\n  }\n\n  if (type.indexOf('touch') >= 0) {\n    return 'touch';\n  }\n\n  return 'mouse';\n};\n\nconst getEventsMap = eventType => {\n  const type = getEventType(eventType);\n\n  if (type === 'pointer') {\n    return Global_1.Konva.pointerEventsEnabled && EVENTS_MAP.pointer;\n  }\n\n  if (type === 'touch') {\n    return EVENTS_MAP.touch;\n  }\n\n  if (type === 'mouse') {\n    return EVENTS_MAP.mouse;\n  }\n};\n\nfunction checkNoClip() {\n  let attrs = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n\n  if (attrs.clipFunc || attrs.clipWidth || attrs.clipHeight) {\n    Util_1.Util.warn('Stage does not support clipping. Please use clip for Layers or Groups.');\n  }\n\n  return attrs;\n}\n\nconst NO_POINTERS_MESSAGE = `Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);`;\nexports.stages = [];\n\nclass Stage extends Container_1.Container {\n  constructor(config) {\n    super(checkNoClip(config));\n    this._pointerPositions = [];\n    this._changedPointerPositions = [];\n\n    this._buildDOM();\n\n    this._bindContentEvents();\n\n    exports.stages.push(this);\n    this.on('widthChange.konva heightChange.konva', this._resizeDOM);\n    this.on('visibleChange.konva', this._checkVisibility);\n    this.on('clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva', () => {\n      checkNoClip(this.attrs);\n    });\n\n    this._checkVisibility();\n  }\n\n  _validateAdd(child) {\n    const isLayer = child.getType() === 'Layer';\n    const isFastLayer = child.getType() === 'FastLayer';\n    const valid = isLayer || isFastLayer;\n\n    if (!valid) {\n      Util_1.Util.throw('You may only add layers to the stage.');\n    }\n  }\n\n  _checkVisibility() {\n    if (!this.content) {\n      return;\n    }\n\n    const style = this.visible() ? '' : 'none';\n    this.content.style.display = style;\n  }\n\n  setContainer(container) {\n    if (typeof container === STRING) {\n      if (container.charAt(0) === '.') {\n        var className = container.slice(1);\n        container = document.getElementsByClassName(className)[0];\n      } else {\n        var id;\n\n        if (container.charAt(0) !== '#') {\n          id = container;\n        } else {\n          id = container.slice(1);\n        }\n\n        container = document.getElementById(id);\n      }\n\n      if (!container) {\n        throw 'Can not find container in document with id ' + id;\n      }\n    }\n\n    this._setAttr('container', container);\n\n    if (this.content) {\n      if (this.content.parentElement) {\n        this.content.parentElement.removeChild(this.content);\n      }\n\n      container.appendChild(this.content);\n    }\n\n    return this;\n  }\n\n  shouldDrawHit() {\n    return true;\n  }\n\n  clear() {\n    var layers = this.children,\n        len = layers.length,\n        n;\n\n    for (n = 0; n < len; n++) {\n      layers[n].clear();\n    }\n\n    return this;\n  }\n\n  clone(obj) {\n    if (!obj) {\n      obj = {};\n    }\n\n    obj.container = typeof document !== 'undefined' && document.createElement('div');\n    return Container_1.Container.prototype.clone.call(this, obj);\n  }\n\n  destroy() {\n    super.destroy();\n    var content = this.content;\n\n    if (content && Util_1.Util._isInDocument(content)) {\n      this.container().removeChild(content);\n    }\n\n    var index = exports.stages.indexOf(this);\n\n    if (index > -1) {\n      exports.stages.splice(index, 1);\n    }\n\n    Util_1.Util.releaseCanvas(this.bufferCanvas._canvas, this.bufferHitCanvas._canvas);\n    return this;\n  }\n\n  getPointerPosition() {\n    const pos = this._pointerPositions[0] || this._changedPointerPositions[0];\n\n    if (!pos) {\n      Util_1.Util.warn(NO_POINTERS_MESSAGE);\n      return null;\n    }\n\n    return {\n      x: pos.x,\n      y: pos.y\n    };\n  }\n\n  _getPointerById(id) {\n    return this._pointerPositions.find(p => p.id === id);\n  }\n\n  getPointersPositions() {\n    return this._pointerPositions;\n  }\n\n  getStage() {\n    return this;\n  }\n\n  getContent() {\n    return this.content;\n  }\n\n  _toKonvaCanvas(config) {\n    config = config || {};\n    config.x = config.x || 0;\n    config.y = config.y || 0;\n    config.width = config.width || this.width();\n    config.height = config.height || this.height();\n    var canvas = new Canvas_1.SceneCanvas({\n      width: config.width,\n      height: config.height,\n      pixelRatio: config.pixelRatio || 1\n    });\n\n    var _context = canvas.getContext()._context;\n\n    var layers = this.children;\n\n    if (config.x || config.y) {\n      _context.translate(-1 * config.x, -1 * config.y);\n    }\n\n    layers.forEach(function (layer) {\n      if (!layer.isVisible()) {\n        return;\n      }\n\n      var layerCanvas = layer._toKonvaCanvas(config);\n\n      _context.drawImage(layerCanvas._canvas, config.x, config.y, layerCanvas.getWidth() / layerCanvas.getPixelRatio(), layerCanvas.getHeight() / layerCanvas.getPixelRatio());\n    });\n    return canvas;\n  }\n\n  getIntersection(pos) {\n    if (!pos) {\n      return null;\n    }\n\n    var layers = this.children,\n        len = layers.length,\n        end = len - 1,\n        n;\n\n    for (n = end; n >= 0; n--) {\n      const shape = layers[n].getIntersection(pos);\n\n      if (shape) {\n        return shape;\n      }\n    }\n\n    return null;\n  }\n\n  _resizeDOM() {\n    var width = this.width();\n    var height = this.height();\n\n    if (this.content) {\n      this.content.style.width = width + PX;\n      this.content.style.height = height + PX;\n    }\n\n    this.bufferCanvas.setSize(width, height);\n    this.bufferHitCanvas.setSize(width, height);\n    this.children.forEach(layer => {\n      layer.setSize({\n        width,\n        height\n      });\n      layer.draw();\n    });\n  }\n\n  add(layer) {\n    for (var _len = arguments.length, rest = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      rest[_key - 1] = arguments[_key];\n    }\n\n    if (arguments.length > 1) {\n      for (var i = 0; i < arguments.length; i++) {\n        this.add(arguments[i]);\n      }\n\n      return this;\n    }\n\n    super.add(layer);\n    var length = this.children.length;\n\n    if (length > MAX_LAYERS_NUMBER) {\n      Util_1.Util.warn('The stage has ' + length + ' layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group.');\n    }\n\n    layer.setSize({\n      width: this.width(),\n      height: this.height()\n    });\n    layer.draw();\n\n    if (Global_1.Konva.isBrowser) {\n      this.content.appendChild(layer.canvas._canvas);\n    }\n\n    return this;\n  }\n\n  getParent() {\n    return null;\n  }\n\n  getLayer() {\n    return null;\n  }\n\n  hasPointerCapture(pointerId) {\n    return PointerEvents.hasPointerCapture(pointerId, this);\n  }\n\n  setPointerCapture(pointerId) {\n    PointerEvents.setPointerCapture(pointerId, this);\n  }\n\n  releaseCapture(pointerId) {\n    PointerEvents.releaseCapture(pointerId, this);\n  }\n\n  getLayers() {\n    return this.children;\n  }\n\n  _bindContentEvents() {\n    if (!Global_1.Konva.isBrowser) {\n      return;\n    }\n\n    EVENTS.forEach(_ref => {\n      let [event, methodName] = _ref;\n      this.content.addEventListener(event, evt => {\n        this[methodName](evt);\n      }, {\n        passive: false\n      });\n    });\n  }\n\n  _pointerenter(evt) {\n    this.setPointersPositions(evt);\n    const events = getEventsMap(evt.type);\n\n    if (events) {\n      this._fire(events.pointerenter, {\n        evt: evt,\n        target: this,\n        currentTarget: this\n      });\n    }\n  }\n\n  _pointerover(evt) {\n    this.setPointersPositions(evt);\n    const events = getEventsMap(evt.type);\n\n    if (events) {\n      this._fire(events.pointerover, {\n        evt: evt,\n        target: this,\n        currentTarget: this\n      });\n    }\n  }\n\n  _getTargetShape(evenType) {\n    let shape = this[evenType + 'targetShape'];\n\n    if (shape && !shape.getStage()) {\n      shape = null;\n    }\n\n    return shape;\n  }\n\n  _pointerleave(evt) {\n    const events = getEventsMap(evt.type);\n    const eventType = getEventType(evt.type);\n\n    if (!events) {\n      return;\n    }\n\n    this.setPointersPositions(evt);\n\n    var targetShape = this._getTargetShape(eventType);\n\n    var eventsEnabled = !(Global_1.Konva.isDragging() || Global_1.Konva.isTransforming()) || Global_1.Konva.hitOnDragEnabled;\n\n    if (targetShape && eventsEnabled) {\n      targetShape._fireAndBubble(events.pointerout, {\n        evt: evt\n      });\n\n      targetShape._fireAndBubble(events.pointerleave, {\n        evt: evt\n      });\n\n      this._fire(events.pointerleave, {\n        evt: evt,\n        target: this,\n        currentTarget: this\n      });\n\n      this[eventType + 'targetShape'] = null;\n    } else if (eventsEnabled) {\n      this._fire(events.pointerleave, {\n        evt: evt,\n        target: this,\n        currentTarget: this\n      });\n\n      this._fire(events.pointerout, {\n        evt: evt,\n        target: this,\n        currentTarget: this\n      });\n    }\n\n    this.pointerPos = null;\n    this._pointerPositions = [];\n  }\n\n  _pointerdown(evt) {\n    const events = getEventsMap(evt.type);\n    const eventType = getEventType(evt.type);\n\n    if (!events) {\n      return;\n    }\n\n    this.setPointersPositions(evt);\n    var triggeredOnShape = false;\n\n    this._changedPointerPositions.forEach(pos => {\n      var shape = this.getIntersection(pos);\n      DragAndDrop_1.DD.justDragged = false;\n      Global_1.Konva['_' + eventType + 'ListenClick'] = true;\n\n      if (!shape || !shape.isListening()) {\n        this[eventType + 'ClickStartShape'] = undefined;\n        return;\n      }\n\n      if (Global_1.Konva.capturePointerEventsEnabled) {\n        shape.setPointerCapture(pos.id);\n      }\n\n      this[eventType + 'ClickStartShape'] = shape;\n\n      shape._fireAndBubble(events.pointerdown, {\n        evt: evt,\n        pointerId: pos.id\n      });\n\n      triggeredOnShape = true;\n      const isTouch = evt.type.indexOf('touch') >= 0;\n\n      if (shape.preventDefault() && evt.cancelable && isTouch) {\n        evt.preventDefault();\n      }\n    });\n\n    if (!triggeredOnShape) {\n      this._fire(events.pointerdown, {\n        evt: evt,\n        target: this,\n        currentTarget: this,\n        pointerId: this._pointerPositions[0].id\n      });\n    }\n  }\n\n  _pointermove(evt) {\n    const events = getEventsMap(evt.type);\n    const eventType = getEventType(evt.type);\n\n    if (!events) {\n      return;\n    }\n\n    if (Global_1.Konva.isDragging() && DragAndDrop_1.DD.node.preventDefault() && evt.cancelable) {\n      evt.preventDefault();\n    }\n\n    this.setPointersPositions(evt);\n    var eventsEnabled = !(Global_1.Konva.isDragging() || Global_1.Konva.isTransforming()) || Global_1.Konva.hitOnDragEnabled;\n\n    if (!eventsEnabled) {\n      return;\n    }\n\n    var processedShapesIds = {};\n    let triggeredOnShape = false;\n\n    var targetShape = this._getTargetShape(eventType);\n\n    this._changedPointerPositions.forEach(pos => {\n      const shape = PointerEvents.getCapturedShape(pos.id) || this.getIntersection(pos);\n      const pointerId = pos.id;\n      const event = {\n        evt: evt,\n        pointerId\n      };\n      var differentTarget = targetShape !== shape;\n\n      if (differentTarget && targetShape) {\n        targetShape._fireAndBubble(events.pointerout, { ...event\n        }, shape);\n\n        targetShape._fireAndBubble(events.pointerleave, { ...event\n        }, shape);\n      }\n\n      if (shape) {\n        if (processedShapesIds[shape._id]) {\n          return;\n        }\n\n        processedShapesIds[shape._id] = true;\n      }\n\n      if (shape && shape.isListening()) {\n        triggeredOnShape = true;\n\n        if (differentTarget) {\n          shape._fireAndBubble(events.pointerover, { ...event\n          }, targetShape);\n\n          shape._fireAndBubble(events.pointerenter, { ...event\n          }, targetShape);\n\n          this[eventType + 'targetShape'] = shape;\n        }\n\n        shape._fireAndBubble(events.pointermove, { ...event\n        });\n      } else {\n        if (targetShape) {\n          this._fire(events.pointerover, {\n            evt: evt,\n            target: this,\n            currentTarget: this,\n            pointerId\n          });\n\n          this[eventType + 'targetShape'] = null;\n        }\n      }\n    });\n\n    if (!triggeredOnShape) {\n      this._fire(events.pointermove, {\n        evt: evt,\n        target: this,\n        currentTarget: this,\n        pointerId: this._changedPointerPositions[0].id\n      });\n    }\n  }\n\n  _pointerup(evt) {\n    const events = getEventsMap(evt.type);\n    const eventType = getEventType(evt.type);\n\n    if (!events) {\n      return;\n    }\n\n    this.setPointersPositions(evt);\n    const clickStartShape = this[eventType + 'ClickStartShape'];\n    const clickEndShape = this[eventType + 'ClickEndShape'];\n    var processedShapesIds = {};\n    let triggeredOnShape = false;\n\n    this._changedPointerPositions.forEach(pos => {\n      const shape = PointerEvents.getCapturedShape(pos.id) || this.getIntersection(pos);\n\n      if (shape) {\n        shape.releaseCapture(pos.id);\n\n        if (processedShapesIds[shape._id]) {\n          return;\n        }\n\n        processedShapesIds[shape._id] = true;\n      }\n\n      const pointerId = pos.id;\n      const event = {\n        evt: evt,\n        pointerId\n      };\n      let fireDblClick = false;\n\n      if (Global_1.Konva['_' + eventType + 'InDblClickWindow']) {\n        fireDblClick = true;\n        clearTimeout(this[eventType + 'DblTimeout']);\n      } else if (!DragAndDrop_1.DD.justDragged) {\n        Global_1.Konva['_' + eventType + 'InDblClickWindow'] = true;\n        clearTimeout(this[eventType + 'DblTimeout']);\n      }\n\n      this[eventType + 'DblTimeout'] = setTimeout(function () {\n        Global_1.Konva['_' + eventType + 'InDblClickWindow'] = false;\n      }, Global_1.Konva.dblClickWindow);\n\n      if (shape && shape.isListening()) {\n        triggeredOnShape = true;\n        this[eventType + 'ClickEndShape'] = shape;\n\n        shape._fireAndBubble(events.pointerup, { ...event\n        });\n\n        if (Global_1.Konva['_' + eventType + 'ListenClick'] && clickStartShape && clickStartShape === shape) {\n          shape._fireAndBubble(events.pointerclick, { ...event\n          });\n\n          if (fireDblClick && clickEndShape && clickEndShape === shape) {\n            shape._fireAndBubble(events.pointerdblclick, { ...event\n            });\n          }\n        }\n      } else {\n        this[eventType + 'ClickEndShape'] = null;\n\n        if (Global_1.Konva['_' + eventType + 'ListenClick']) {\n          this._fire(events.pointerclick, {\n            evt: evt,\n            target: this,\n            currentTarget: this,\n            pointerId\n          });\n        }\n\n        if (fireDblClick) {\n          this._fire(events.pointerdblclick, {\n            evt: evt,\n            target: this,\n            currentTarget: this,\n            pointerId\n          });\n        }\n      }\n    });\n\n    if (!triggeredOnShape) {\n      this._fire(events.pointerup, {\n        evt: evt,\n        target: this,\n        currentTarget: this,\n        pointerId: this._changedPointerPositions[0].id\n      });\n    }\n\n    Global_1.Konva['_' + eventType + 'ListenClick'] = false;\n\n    if (evt.cancelable && eventType !== 'touch') {\n      evt.preventDefault();\n    }\n  }\n\n  _contextmenu(evt) {\n    this.setPointersPositions(evt);\n    var shape = this.getIntersection(this.getPointerPosition());\n\n    if (shape && shape.isListening()) {\n      shape._fireAndBubble(CONTEXTMENU, {\n        evt: evt\n      });\n    } else {\n      this._fire(CONTEXTMENU, {\n        evt: evt,\n        target: this,\n        currentTarget: this\n      });\n    }\n  }\n\n  _wheel(evt) {\n    this.setPointersPositions(evt);\n    var shape = this.getIntersection(this.getPointerPosition());\n\n    if (shape && shape.isListening()) {\n      shape._fireAndBubble(WHEEL, {\n        evt: evt\n      });\n    } else {\n      this._fire(WHEEL, {\n        evt: evt,\n        target: this,\n        currentTarget: this\n      });\n    }\n  }\n\n  _pointercancel(evt) {\n    this.setPointersPositions(evt);\n    const shape = PointerEvents.getCapturedShape(evt.pointerId) || this.getIntersection(this.getPointerPosition());\n\n    if (shape) {\n      shape._fireAndBubble(POINTERUP, PointerEvents.createEvent(evt));\n    }\n\n    PointerEvents.releaseCapture(evt.pointerId);\n  }\n\n  _lostpointercapture(evt) {\n    PointerEvents.releaseCapture(evt.pointerId);\n  }\n\n  setPointersPositions(evt) {\n    var contentPosition = this._getContentPosition(),\n        x = null,\n        y = null;\n\n    evt = evt ? evt : window.event;\n\n    if (evt.touches !== undefined) {\n      this._pointerPositions = [];\n      this._changedPointerPositions = [];\n      Array.prototype.forEach.call(evt.touches, touch => {\n        this._pointerPositions.push({\n          id: touch.identifier,\n          x: (touch.clientX - contentPosition.left) / contentPosition.scaleX,\n          y: (touch.clientY - contentPosition.top) / contentPosition.scaleY\n        });\n      });\n      Array.prototype.forEach.call(evt.changedTouches || evt.touches, touch => {\n        this._changedPointerPositions.push({\n          id: touch.identifier,\n          x: (touch.clientX - contentPosition.left) / contentPosition.scaleX,\n          y: (touch.clientY - contentPosition.top) / contentPosition.scaleY\n        });\n      });\n    } else {\n      x = (evt.clientX - contentPosition.left) / contentPosition.scaleX;\n      y = (evt.clientY - contentPosition.top) / contentPosition.scaleY;\n      this.pointerPos = {\n        x: x,\n        y: y\n      };\n      this._pointerPositions = [{\n        x,\n        y,\n        id: Util_1.Util._getFirstPointerId(evt)\n      }];\n      this._changedPointerPositions = [{\n        x,\n        y,\n        id: Util_1.Util._getFirstPointerId(evt)\n      }];\n    }\n  }\n\n  _setPointerPosition(evt) {\n    Util_1.Util.warn('Method _setPointerPosition is deprecated. Use \"stage.setPointersPositions(event)\" instead.');\n    this.setPointersPositions(evt);\n  }\n\n  _getContentPosition() {\n    if (!this.content || !this.content.getBoundingClientRect) {\n      return {\n        top: 0,\n        left: 0,\n        scaleX: 1,\n        scaleY: 1\n      };\n    }\n\n    var rect = this.content.getBoundingClientRect();\n    return {\n      top: rect.top,\n      left: rect.left,\n      scaleX: rect.width / this.content.clientWidth || 1,\n      scaleY: rect.height / this.content.clientHeight || 1\n    };\n  }\n\n  _buildDOM() {\n    this.bufferCanvas = new Canvas_1.SceneCanvas({\n      width: this.width(),\n      height: this.height()\n    });\n    this.bufferHitCanvas = new Canvas_1.HitCanvas({\n      pixelRatio: 1,\n      width: this.width(),\n      height: this.height()\n    });\n\n    if (!Global_1.Konva.isBrowser) {\n      return;\n    }\n\n    var container = this.container();\n\n    if (!container) {\n      throw 'Stage has no container. A container is required.';\n    }\n\n    container.innerHTML = '';\n    this.content = document.createElement('div');\n    this.content.style.position = 'relative';\n    this.content.style.userSelect = 'none';\n    this.content.className = 'konvajs-content';\n    this.content.setAttribute('role', 'presentation');\n    container.appendChild(this.content);\n\n    this._resizeDOM();\n  }\n\n  cache() {\n    Util_1.Util.warn('Cache function is not allowed for stage. You may use cache only for layers, groups and shapes.');\n    return this;\n  }\n\n  clearCache() {\n    return this;\n  }\n\n  batchDraw() {\n    this.getChildren().forEach(function (layer) {\n      layer.batchDraw();\n    });\n    return this;\n  }\n\n}\n\nexports.Stage = Stage;\nStage.prototype.nodeType = STAGE;\n(0, Global_2._registerNode)(Stage);\nFactory_1.Factory.addGetterSetter(Stage, 'container');\n\nif (Global_1.Konva.isBrowser) {\n  document.addEventListener('visibilitychange', () => {\n    exports.stages.forEach(stage => {\n      stage.batchDraw();\n    });\n  });\n}","map":{"version":3,"names":["Object","defineProperty","exports","value","Stage","stages","Util_1","require","Factory_1","Container_1","Global_1","Canvas_1","DragAndDrop_1","Global_2","PointerEvents","STAGE","STRING","PX","MOUSEOUT","MOUSELEAVE","MOUSEOVER","MOUSEENTER","MOUSEMOVE","MOUSEDOWN","MOUSEUP","POINTERMOVE","POINTERDOWN","POINTERUP","POINTERCANCEL","LOSTPOINTERCAPTURE","POINTEROUT","POINTERLEAVE","POINTEROVER","POINTERENTER","CONTEXTMENU","TOUCHSTART","TOUCHEND","TOUCHMOVE","TOUCHCANCEL","WHEEL","MAX_LAYERS_NUMBER","EVENTS","EVENTS_MAP","mouse","pointerclick","pointerdblclick","touch","pointer","getEventType","type","indexOf","getEventsMap","eventType","Konva","pointerEventsEnabled","checkNoClip","attrs","clipFunc","clipWidth","clipHeight","Util","warn","NO_POINTERS_MESSAGE","Container","constructor","config","_pointerPositions","_changedPointerPositions","_buildDOM","_bindContentEvents","push","on","_resizeDOM","_checkVisibility","_validateAdd","child","isLayer","getType","isFastLayer","valid","throw","content","style","visible","display","setContainer","container","charAt","className","slice","document","getElementsByClassName","id","getElementById","_setAttr","parentElement","removeChild","appendChild","shouldDrawHit","clear","layers","children","len","length","n","clone","obj","createElement","prototype","call","destroy","_isInDocument","index","splice","releaseCanvas","bufferCanvas","_canvas","bufferHitCanvas","getPointerPosition","pos","x","y","_getPointerById","find","p","getPointersPositions","getStage","getContent","_toKonvaCanvas","width","height","canvas","SceneCanvas","pixelRatio","_context","getContext","translate","forEach","layer","isVisible","layerCanvas","drawImage","getWidth","getPixelRatio","getHeight","getIntersection","end","shape","setSize","draw","add","rest","arguments","i","isBrowser","getParent","getLayer","hasPointerCapture","pointerId","setPointerCapture","releaseCapture","getLayers","event","methodName","addEventListener","evt","passive","_pointerenter","setPointersPositions","events","_fire","pointerenter","target","currentTarget","_pointerover","pointerover","_getTargetShape","evenType","_pointerleave","targetShape","eventsEnabled","isDragging","isTransforming","hitOnDragEnabled","_fireAndBubble","pointerout","pointerleave","pointerPos","_pointerdown","triggeredOnShape","DD","justDragged","isListening","undefined","capturePointerEventsEnabled","pointerdown","isTouch","preventDefault","cancelable","_pointermove","node","processedShapesIds","getCapturedShape","differentTarget","_id","pointermove","_pointerup","clickStartShape","clickEndShape","fireDblClick","clearTimeout","setTimeout","dblClickWindow","pointerup","_contextmenu","_wheel","_pointercancel","createEvent","_lostpointercapture","contentPosition","_getContentPosition","window","touches","Array","identifier","clientX","left","scaleX","clientY","top","scaleY","changedTouches","_getFirstPointerId","_setPointerPosition","getBoundingClientRect","rect","clientWidth","clientHeight","HitCanvas","innerHTML","position","userSelect","setAttribute","cache","clearCache","batchDraw","getChildren","nodeType","_registerNode","Factory","addGetterSetter","stage"],"sources":["D:/screenshort-extension/image-editor-react/node_modules/konva/lib/Stage.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Stage = exports.stages = void 0;\nconst Util_1 = require(\"./Util\");\nconst Factory_1 = require(\"./Factory\");\nconst Container_1 = require(\"./Container\");\nconst Global_1 = require(\"./Global\");\nconst Canvas_1 = require(\"./Canvas\");\nconst DragAndDrop_1 = require(\"./DragAndDrop\");\nconst Global_2 = require(\"./Global\");\nconst PointerEvents = require(\"./PointerEvents\");\nvar STAGE = 'Stage', STRING = 'string', PX = 'px', MOUSEOUT = 'mouseout', MOUSELEAVE = 'mouseleave', MOUSEOVER = 'mouseover', MOUSEENTER = 'mouseenter', MOUSEMOVE = 'mousemove', MOUSEDOWN = 'mousedown', MOUSEUP = 'mouseup', POINTERMOVE = 'pointermove', POINTERDOWN = 'pointerdown', POINTERUP = 'pointerup', POINTERCANCEL = 'pointercancel', LOSTPOINTERCAPTURE = 'lostpointercapture', POINTEROUT = 'pointerout', POINTERLEAVE = 'pointerleave', POINTEROVER = 'pointerover', POINTERENTER = 'pointerenter', CONTEXTMENU = 'contextmenu', TOUCHSTART = 'touchstart', TOUCHEND = 'touchend', TOUCHMOVE = 'touchmove', TOUCHCANCEL = 'touchcancel', WHEEL = 'wheel', MAX_LAYERS_NUMBER = 5, EVENTS = [\n    [MOUSEENTER, '_pointerenter'],\n    [MOUSEDOWN, '_pointerdown'],\n    [MOUSEMOVE, '_pointermove'],\n    [MOUSEUP, '_pointerup'],\n    [MOUSELEAVE, '_pointerleave'],\n    [TOUCHSTART, '_pointerdown'],\n    [TOUCHMOVE, '_pointermove'],\n    [TOUCHEND, '_pointerup'],\n    [TOUCHCANCEL, '_pointercancel'],\n    [MOUSEOVER, '_pointerover'],\n    [WHEEL, '_wheel'],\n    [CONTEXTMENU, '_contextmenu'],\n    [POINTERDOWN, '_pointerdown'],\n    [POINTERMOVE, '_pointermove'],\n    [POINTERUP, '_pointerup'],\n    [POINTERCANCEL, '_pointercancel'],\n    [LOSTPOINTERCAPTURE, '_lostpointercapture'],\n];\nconst EVENTS_MAP = {\n    mouse: {\n        [POINTEROUT]: MOUSEOUT,\n        [POINTERLEAVE]: MOUSELEAVE,\n        [POINTEROVER]: MOUSEOVER,\n        [POINTERENTER]: MOUSEENTER,\n        [POINTERMOVE]: MOUSEMOVE,\n        [POINTERDOWN]: MOUSEDOWN,\n        [POINTERUP]: MOUSEUP,\n        [POINTERCANCEL]: 'mousecancel',\n        pointerclick: 'click',\n        pointerdblclick: 'dblclick',\n    },\n    touch: {\n        [POINTEROUT]: 'touchout',\n        [POINTERLEAVE]: 'touchleave',\n        [POINTEROVER]: 'touchover',\n        [POINTERENTER]: 'touchenter',\n        [POINTERMOVE]: TOUCHMOVE,\n        [POINTERDOWN]: TOUCHSTART,\n        [POINTERUP]: TOUCHEND,\n        [POINTERCANCEL]: TOUCHCANCEL,\n        pointerclick: 'tap',\n        pointerdblclick: 'dbltap',\n    },\n    pointer: {\n        [POINTEROUT]: POINTEROUT,\n        [POINTERLEAVE]: POINTERLEAVE,\n        [POINTEROVER]: POINTEROVER,\n        [POINTERENTER]: POINTERENTER,\n        [POINTERMOVE]: POINTERMOVE,\n        [POINTERDOWN]: POINTERDOWN,\n        [POINTERUP]: POINTERUP,\n        [POINTERCANCEL]: POINTERCANCEL,\n        pointerclick: 'pointerclick',\n        pointerdblclick: 'pointerdblclick',\n    },\n};\nconst getEventType = (type) => {\n    if (type.indexOf('pointer') >= 0) {\n        return 'pointer';\n    }\n    if (type.indexOf('touch') >= 0) {\n        return 'touch';\n    }\n    return 'mouse';\n};\nconst getEventsMap = (eventType) => {\n    const type = getEventType(eventType);\n    if (type === 'pointer') {\n        return Global_1.Konva.pointerEventsEnabled && EVENTS_MAP.pointer;\n    }\n    if (type === 'touch') {\n        return EVENTS_MAP.touch;\n    }\n    if (type === 'mouse') {\n        return EVENTS_MAP.mouse;\n    }\n};\nfunction checkNoClip(attrs = {}) {\n    if (attrs.clipFunc || attrs.clipWidth || attrs.clipHeight) {\n        Util_1.Util.warn('Stage does not support clipping. Please use clip for Layers or Groups.');\n    }\n    return attrs;\n}\nconst NO_POINTERS_MESSAGE = `Pointer position is missing and not registered by the stage. Looks like it is outside of the stage container. You can set it manually from event: stage.setPointersPositions(event);`;\nexports.stages = [];\nclass Stage extends Container_1.Container {\n    constructor(config) {\n        super(checkNoClip(config));\n        this._pointerPositions = [];\n        this._changedPointerPositions = [];\n        this._buildDOM();\n        this._bindContentEvents();\n        exports.stages.push(this);\n        this.on('widthChange.konva heightChange.konva', this._resizeDOM);\n        this.on('visibleChange.konva', this._checkVisibility);\n        this.on('clipWidthChange.konva clipHeightChange.konva clipFuncChange.konva', () => {\n            checkNoClip(this.attrs);\n        });\n        this._checkVisibility();\n    }\n    _validateAdd(child) {\n        const isLayer = child.getType() === 'Layer';\n        const isFastLayer = child.getType() === 'FastLayer';\n        const valid = isLayer || isFastLayer;\n        if (!valid) {\n            Util_1.Util.throw('You may only add layers to the stage.');\n        }\n    }\n    _checkVisibility() {\n        if (!this.content) {\n            return;\n        }\n        const style = this.visible() ? '' : 'none';\n        this.content.style.display = style;\n    }\n    setContainer(container) {\n        if (typeof container === STRING) {\n            if (container.charAt(0) === '.') {\n                var className = container.slice(1);\n                container = document.getElementsByClassName(className)[0];\n            }\n            else {\n                var id;\n                if (container.charAt(0) !== '#') {\n                    id = container;\n                }\n                else {\n                    id = container.slice(1);\n                }\n                container = document.getElementById(id);\n            }\n            if (!container) {\n                throw 'Can not find container in document with id ' + id;\n            }\n        }\n        this._setAttr('container', container);\n        if (this.content) {\n            if (this.content.parentElement) {\n                this.content.parentElement.removeChild(this.content);\n            }\n            container.appendChild(this.content);\n        }\n        return this;\n    }\n    shouldDrawHit() {\n        return true;\n    }\n    clear() {\n        var layers = this.children, len = layers.length, n;\n        for (n = 0; n < len; n++) {\n            layers[n].clear();\n        }\n        return this;\n    }\n    clone(obj) {\n        if (!obj) {\n            obj = {};\n        }\n        obj.container =\n            typeof document !== 'undefined' && document.createElement('div');\n        return Container_1.Container.prototype.clone.call(this, obj);\n    }\n    destroy() {\n        super.destroy();\n        var content = this.content;\n        if (content && Util_1.Util._isInDocument(content)) {\n            this.container().removeChild(content);\n        }\n        var index = exports.stages.indexOf(this);\n        if (index > -1) {\n            exports.stages.splice(index, 1);\n        }\n        Util_1.Util.releaseCanvas(this.bufferCanvas._canvas, this.bufferHitCanvas._canvas);\n        return this;\n    }\n    getPointerPosition() {\n        const pos = this._pointerPositions[0] || this._changedPointerPositions[0];\n        if (!pos) {\n            Util_1.Util.warn(NO_POINTERS_MESSAGE);\n            return null;\n        }\n        return {\n            x: pos.x,\n            y: pos.y,\n        };\n    }\n    _getPointerById(id) {\n        return this._pointerPositions.find((p) => p.id === id);\n    }\n    getPointersPositions() {\n        return this._pointerPositions;\n    }\n    getStage() {\n        return this;\n    }\n    getContent() {\n        return this.content;\n    }\n    _toKonvaCanvas(config) {\n        config = config || {};\n        config.x = config.x || 0;\n        config.y = config.y || 0;\n        config.width = config.width || this.width();\n        config.height = config.height || this.height();\n        var canvas = new Canvas_1.SceneCanvas({\n            width: config.width,\n            height: config.height,\n            pixelRatio: config.pixelRatio || 1,\n        });\n        var _context = canvas.getContext()._context;\n        var layers = this.children;\n        if (config.x || config.y) {\n            _context.translate(-1 * config.x, -1 * config.y);\n        }\n        layers.forEach(function (layer) {\n            if (!layer.isVisible()) {\n                return;\n            }\n            var layerCanvas = layer._toKonvaCanvas(config);\n            _context.drawImage(layerCanvas._canvas, config.x, config.y, layerCanvas.getWidth() / layerCanvas.getPixelRatio(), layerCanvas.getHeight() / layerCanvas.getPixelRatio());\n        });\n        return canvas;\n    }\n    getIntersection(pos) {\n        if (!pos) {\n            return null;\n        }\n        var layers = this.children, len = layers.length, end = len - 1, n;\n        for (n = end; n >= 0; n--) {\n            const shape = layers[n].getIntersection(pos);\n            if (shape) {\n                return shape;\n            }\n        }\n        return null;\n    }\n    _resizeDOM() {\n        var width = this.width();\n        var height = this.height();\n        if (this.content) {\n            this.content.style.width = width + PX;\n            this.content.style.height = height + PX;\n        }\n        this.bufferCanvas.setSize(width, height);\n        this.bufferHitCanvas.setSize(width, height);\n        this.children.forEach((layer) => {\n            layer.setSize({ width, height });\n            layer.draw();\n        });\n    }\n    add(layer, ...rest) {\n        if (arguments.length > 1) {\n            for (var i = 0; i < arguments.length; i++) {\n                this.add(arguments[i]);\n            }\n            return this;\n        }\n        super.add(layer);\n        var length = this.children.length;\n        if (length > MAX_LAYERS_NUMBER) {\n            Util_1.Util.warn('The stage has ' +\n                length +\n                ' layers. Recommended maximum number of layers is 3-5. Adding more layers into the stage may drop the performance. Rethink your tree structure, you can use Konva.Group.');\n        }\n        layer.setSize({ width: this.width(), height: this.height() });\n        layer.draw();\n        if (Global_1.Konva.isBrowser) {\n            this.content.appendChild(layer.canvas._canvas);\n        }\n        return this;\n    }\n    getParent() {\n        return null;\n    }\n    getLayer() {\n        return null;\n    }\n    hasPointerCapture(pointerId) {\n        return PointerEvents.hasPointerCapture(pointerId, this);\n    }\n    setPointerCapture(pointerId) {\n        PointerEvents.setPointerCapture(pointerId, this);\n    }\n    releaseCapture(pointerId) {\n        PointerEvents.releaseCapture(pointerId, this);\n    }\n    getLayers() {\n        return this.children;\n    }\n    _bindContentEvents() {\n        if (!Global_1.Konva.isBrowser) {\n            return;\n        }\n        EVENTS.forEach(([event, methodName]) => {\n            this.content.addEventListener(event, (evt) => {\n                this[methodName](evt);\n            }, { passive: false });\n        });\n    }\n    _pointerenter(evt) {\n        this.setPointersPositions(evt);\n        const events = getEventsMap(evt.type);\n        if (events) {\n            this._fire(events.pointerenter, {\n                evt: evt,\n                target: this,\n                currentTarget: this,\n            });\n        }\n    }\n    _pointerover(evt) {\n        this.setPointersPositions(evt);\n        const events = getEventsMap(evt.type);\n        if (events) {\n            this._fire(events.pointerover, {\n                evt: evt,\n                target: this,\n                currentTarget: this,\n            });\n        }\n    }\n    _getTargetShape(evenType) {\n        let shape = this[evenType + 'targetShape'];\n        if (shape && !shape.getStage()) {\n            shape = null;\n        }\n        return shape;\n    }\n    _pointerleave(evt) {\n        const events = getEventsMap(evt.type);\n        const eventType = getEventType(evt.type);\n        if (!events) {\n            return;\n        }\n        this.setPointersPositions(evt);\n        var targetShape = this._getTargetShape(eventType);\n        var eventsEnabled = !(Global_1.Konva.isDragging() || Global_1.Konva.isTransforming()) || Global_1.Konva.hitOnDragEnabled;\n        if (targetShape && eventsEnabled) {\n            targetShape._fireAndBubble(events.pointerout, { evt: evt });\n            targetShape._fireAndBubble(events.pointerleave, { evt: evt });\n            this._fire(events.pointerleave, {\n                evt: evt,\n                target: this,\n                currentTarget: this,\n            });\n            this[eventType + 'targetShape'] = null;\n        }\n        else if (eventsEnabled) {\n            this._fire(events.pointerleave, {\n                evt: evt,\n                target: this,\n                currentTarget: this,\n            });\n            this._fire(events.pointerout, {\n                evt: evt,\n                target: this,\n                currentTarget: this,\n            });\n        }\n        this.pointerPos = null;\n        this._pointerPositions = [];\n    }\n    _pointerdown(evt) {\n        const events = getEventsMap(evt.type);\n        const eventType = getEventType(evt.type);\n        if (!events) {\n            return;\n        }\n        this.setPointersPositions(evt);\n        var triggeredOnShape = false;\n        this._changedPointerPositions.forEach((pos) => {\n            var shape = this.getIntersection(pos);\n            DragAndDrop_1.DD.justDragged = false;\n            Global_1.Konva['_' + eventType + 'ListenClick'] = true;\n            if (!shape || !shape.isListening()) {\n                this[eventType + 'ClickStartShape'] = undefined;\n                return;\n            }\n            if (Global_1.Konva.capturePointerEventsEnabled) {\n                shape.setPointerCapture(pos.id);\n            }\n            this[eventType + 'ClickStartShape'] = shape;\n            shape._fireAndBubble(events.pointerdown, {\n                evt: evt,\n                pointerId: pos.id,\n            });\n            triggeredOnShape = true;\n            const isTouch = evt.type.indexOf('touch') >= 0;\n            if (shape.preventDefault() && evt.cancelable && isTouch) {\n                evt.preventDefault();\n            }\n        });\n        if (!triggeredOnShape) {\n            this._fire(events.pointerdown, {\n                evt: evt,\n                target: this,\n                currentTarget: this,\n                pointerId: this._pointerPositions[0].id,\n            });\n        }\n    }\n    _pointermove(evt) {\n        const events = getEventsMap(evt.type);\n        const eventType = getEventType(evt.type);\n        if (!events) {\n            return;\n        }\n        if (Global_1.Konva.isDragging() && DragAndDrop_1.DD.node.preventDefault() && evt.cancelable) {\n            evt.preventDefault();\n        }\n        this.setPointersPositions(evt);\n        var eventsEnabled = !(Global_1.Konva.isDragging() || Global_1.Konva.isTransforming()) || Global_1.Konva.hitOnDragEnabled;\n        if (!eventsEnabled) {\n            return;\n        }\n        var processedShapesIds = {};\n        let triggeredOnShape = false;\n        var targetShape = this._getTargetShape(eventType);\n        this._changedPointerPositions.forEach((pos) => {\n            const shape = (PointerEvents.getCapturedShape(pos.id) ||\n                this.getIntersection(pos));\n            const pointerId = pos.id;\n            const event = { evt: evt, pointerId };\n            var differentTarget = targetShape !== shape;\n            if (differentTarget && targetShape) {\n                targetShape._fireAndBubble(events.pointerout, { ...event }, shape);\n                targetShape._fireAndBubble(events.pointerleave, { ...event }, shape);\n            }\n            if (shape) {\n                if (processedShapesIds[shape._id]) {\n                    return;\n                }\n                processedShapesIds[shape._id] = true;\n            }\n            if (shape && shape.isListening()) {\n                triggeredOnShape = true;\n                if (differentTarget) {\n                    shape._fireAndBubble(events.pointerover, { ...event }, targetShape);\n                    shape._fireAndBubble(events.pointerenter, { ...event }, targetShape);\n                    this[eventType + 'targetShape'] = shape;\n                }\n                shape._fireAndBubble(events.pointermove, { ...event });\n            }\n            else {\n                if (targetShape) {\n                    this._fire(events.pointerover, {\n                        evt: evt,\n                        target: this,\n                        currentTarget: this,\n                        pointerId,\n                    });\n                    this[eventType + 'targetShape'] = null;\n                }\n            }\n        });\n        if (!triggeredOnShape) {\n            this._fire(events.pointermove, {\n                evt: evt,\n                target: this,\n                currentTarget: this,\n                pointerId: this._changedPointerPositions[0].id,\n            });\n        }\n    }\n    _pointerup(evt) {\n        const events = getEventsMap(evt.type);\n        const eventType = getEventType(evt.type);\n        if (!events) {\n            return;\n        }\n        this.setPointersPositions(evt);\n        const clickStartShape = this[eventType + 'ClickStartShape'];\n        const clickEndShape = this[eventType + 'ClickEndShape'];\n        var processedShapesIds = {};\n        let triggeredOnShape = false;\n        this._changedPointerPositions.forEach((pos) => {\n            const shape = (PointerEvents.getCapturedShape(pos.id) ||\n                this.getIntersection(pos));\n            if (shape) {\n                shape.releaseCapture(pos.id);\n                if (processedShapesIds[shape._id]) {\n                    return;\n                }\n                processedShapesIds[shape._id] = true;\n            }\n            const pointerId = pos.id;\n            const event = { evt: evt, pointerId };\n            let fireDblClick = false;\n            if (Global_1.Konva['_' + eventType + 'InDblClickWindow']) {\n                fireDblClick = true;\n                clearTimeout(this[eventType + 'DblTimeout']);\n            }\n            else if (!DragAndDrop_1.DD.justDragged) {\n                Global_1.Konva['_' + eventType + 'InDblClickWindow'] = true;\n                clearTimeout(this[eventType + 'DblTimeout']);\n            }\n            this[eventType + 'DblTimeout'] = setTimeout(function () {\n                Global_1.Konva['_' + eventType + 'InDblClickWindow'] = false;\n            }, Global_1.Konva.dblClickWindow);\n            if (shape && shape.isListening()) {\n                triggeredOnShape = true;\n                this[eventType + 'ClickEndShape'] = shape;\n                shape._fireAndBubble(events.pointerup, { ...event });\n                if (Global_1.Konva['_' + eventType + 'ListenClick'] &&\n                    clickStartShape &&\n                    clickStartShape === shape) {\n                    shape._fireAndBubble(events.pointerclick, { ...event });\n                    if (fireDblClick && clickEndShape && clickEndShape === shape) {\n                        shape._fireAndBubble(events.pointerdblclick, { ...event });\n                    }\n                }\n            }\n            else {\n                this[eventType + 'ClickEndShape'] = null;\n                if (Global_1.Konva['_' + eventType + 'ListenClick']) {\n                    this._fire(events.pointerclick, {\n                        evt: evt,\n                        target: this,\n                        currentTarget: this,\n                        pointerId,\n                    });\n                }\n                if (fireDblClick) {\n                    this._fire(events.pointerdblclick, {\n                        evt: evt,\n                        target: this,\n                        currentTarget: this,\n                        pointerId,\n                    });\n                }\n            }\n        });\n        if (!triggeredOnShape) {\n            this._fire(events.pointerup, {\n                evt: evt,\n                target: this,\n                currentTarget: this,\n                pointerId: this._changedPointerPositions[0].id,\n            });\n        }\n        Global_1.Konva['_' + eventType + 'ListenClick'] = false;\n        if (evt.cancelable && eventType !== 'touch') {\n            evt.preventDefault();\n        }\n    }\n    _contextmenu(evt) {\n        this.setPointersPositions(evt);\n        var shape = this.getIntersection(this.getPointerPosition());\n        if (shape && shape.isListening()) {\n            shape._fireAndBubble(CONTEXTMENU, { evt: evt });\n        }\n        else {\n            this._fire(CONTEXTMENU, {\n                evt: evt,\n                target: this,\n                currentTarget: this,\n            });\n        }\n    }\n    _wheel(evt) {\n        this.setPointersPositions(evt);\n        var shape = this.getIntersection(this.getPointerPosition());\n        if (shape && shape.isListening()) {\n            shape._fireAndBubble(WHEEL, { evt: evt });\n        }\n        else {\n            this._fire(WHEEL, {\n                evt: evt,\n                target: this,\n                currentTarget: this,\n            });\n        }\n    }\n    _pointercancel(evt) {\n        this.setPointersPositions(evt);\n        const shape = PointerEvents.getCapturedShape(evt.pointerId) ||\n            this.getIntersection(this.getPointerPosition());\n        if (shape) {\n            shape._fireAndBubble(POINTERUP, PointerEvents.createEvent(evt));\n        }\n        PointerEvents.releaseCapture(evt.pointerId);\n    }\n    _lostpointercapture(evt) {\n        PointerEvents.releaseCapture(evt.pointerId);\n    }\n    setPointersPositions(evt) {\n        var contentPosition = this._getContentPosition(), x = null, y = null;\n        evt = evt ? evt : window.event;\n        if (evt.touches !== undefined) {\n            this._pointerPositions = [];\n            this._changedPointerPositions = [];\n            Array.prototype.forEach.call(evt.touches, (touch) => {\n                this._pointerPositions.push({\n                    id: touch.identifier,\n                    x: (touch.clientX - contentPosition.left) / contentPosition.scaleX,\n                    y: (touch.clientY - contentPosition.top) / contentPosition.scaleY,\n                });\n            });\n            Array.prototype.forEach.call(evt.changedTouches || evt.touches, (touch) => {\n                this._changedPointerPositions.push({\n                    id: touch.identifier,\n                    x: (touch.clientX - contentPosition.left) / contentPosition.scaleX,\n                    y: (touch.clientY - contentPosition.top) / contentPosition.scaleY,\n                });\n            });\n        }\n        else {\n            x = (evt.clientX - contentPosition.left) / contentPosition.scaleX;\n            y = (evt.clientY - contentPosition.top) / contentPosition.scaleY;\n            this.pointerPos = {\n                x: x,\n                y: y,\n            };\n            this._pointerPositions = [{ x, y, id: Util_1.Util._getFirstPointerId(evt) }];\n            this._changedPointerPositions = [\n                { x, y, id: Util_1.Util._getFirstPointerId(evt) },\n            ];\n        }\n    }\n    _setPointerPosition(evt) {\n        Util_1.Util.warn('Method _setPointerPosition is deprecated. Use \"stage.setPointersPositions(event)\" instead.');\n        this.setPointersPositions(evt);\n    }\n    _getContentPosition() {\n        if (!this.content || !this.content.getBoundingClientRect) {\n            return {\n                top: 0,\n                left: 0,\n                scaleX: 1,\n                scaleY: 1,\n            };\n        }\n        var rect = this.content.getBoundingClientRect();\n        return {\n            top: rect.top,\n            left: rect.left,\n            scaleX: rect.width / this.content.clientWidth || 1,\n            scaleY: rect.height / this.content.clientHeight || 1,\n        };\n    }\n    _buildDOM() {\n        this.bufferCanvas = new Canvas_1.SceneCanvas({\n            width: this.width(),\n            height: this.height(),\n        });\n        this.bufferHitCanvas = new Canvas_1.HitCanvas({\n            pixelRatio: 1,\n            width: this.width(),\n            height: this.height(),\n        });\n        if (!Global_1.Konva.isBrowser) {\n            return;\n        }\n        var container = this.container();\n        if (!container) {\n            throw 'Stage has no container. A container is required.';\n        }\n        container.innerHTML = '';\n        this.content = document.createElement('div');\n        this.content.style.position = 'relative';\n        this.content.style.userSelect = 'none';\n        this.content.className = 'konvajs-content';\n        this.content.setAttribute('role', 'presentation');\n        container.appendChild(this.content);\n        this._resizeDOM();\n    }\n    cache() {\n        Util_1.Util.warn('Cache function is not allowed for stage. You may use cache only for layers, groups and shapes.');\n        return this;\n    }\n    clearCache() {\n        return this;\n    }\n    batchDraw() {\n        this.getChildren().forEach(function (layer) {\n            layer.batchDraw();\n        });\n        return this;\n    }\n}\nexports.Stage = Stage;\nStage.prototype.nodeType = STAGE;\n(0, Global_2._registerNode)(Stage);\nFactory_1.Factory.addGetterSetter(Stage, 'container');\nif (Global_1.Konva.isBrowser) {\n    document.addEventListener('visibilitychange', () => {\n        exports.stages.forEach((stage) => {\n            stage.batchDraw();\n        });\n    });\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}